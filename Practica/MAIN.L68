00001F4E Starting Address
Assembler used: EASy68K Editor/Assembler v5.16.01
Created On: 26/12/2023 23:20:51

00000000                             1  ; =============================================================================
00000000                             2  ; TÍTULO     : PRÁCTICA 1
00000000                             3  ; CREADO POR : KHAOULA IKKENE & ADRIÁN RUIZ VIDAL
00000000                             4  ; FECHA      : EMPEZADO DESDE PRIMERA SEMANA 
00000000                             5  ; DESCRIPCIÓN: JUEGO SPACE INVADERS
00000000                             6  ; =============================================================================
00000000                             7     
00001000                             8              ORG     $1000
00001000                             9          
00001000                            10              INCLUDE "SYSCONST.X68"
00001000                            11  ; ==============================================================================
00001000                            12  ; CONSTANTES DE SISTEMA
00001000                            13  ; ==============================================================================
00001000                            14      
00001000                            15      ;CONSTANTES PANTALLA
00001000  =000001E0                 16  SCRHEIGH    EQU     480
00001000  =00000280                 17  SCRWIDTH    EQU     640
00001000  =00000032                 18  SCRFPS      EQU     50              ;FOTOGRAMAS/SEGUNDO   
00001000                            19  
00001000                            20      ;CONSTANTES LÍMITE PANTALLA
00001000  =00000000                 21  LIMIT   EQU 0                       ;PARA DISPARO            
00001000                            22  
00001000                            23      ;CONSTANTES TECLADO
00001000  =00000025                 24  KBDLEFT     EQU     $25
00001000  =00000026                 25  KBDUP       EQU     $26
00001000  =00000027                 26  KBDRIGHT    EQU     $27
00001000  =00000028                 27  KBDDOWN     EQU     $28
00001000  =00000020                 28  KBDPAUSE    EQU     ' '
00001000  =00000041                 29  KBDFIRE1    EQU     'A'
00001000  =00000053                 30  KBDFIRE2    EQU     'S'
00001000  =00000044                 31  KBDFIRE3    EQU     'D'
00001000                            32  
00001000                            33      ;NÚMEROS DE TRAPS
00001000  =00000000                 34  SCRUPTN     EQU     0
00001000  =00000001                 35  KBDUPTN     EQU     1
00001000  =00000002                 36  SNDPLTN     EQU     2       
00001000                            37  
00001000                            38      ;IDENTIFICADORES DE SONIDO
00001000  =00000000                 39  SNDSHT      EQU     0    
00001000  =00000001                 40  SNDDEM      EQU     1     
00001000  =00000002                 41  SNDWIN      EQU     2
00001000  =00000003                 42  SNDGOV      EQU     3   
00001000                            43  
00001000                            44  
00001000                            45  
00001000                            46  
00001000                            47  
00001000                            48  
00001000                            49  
00001000                            50  
00001000                            51  
00001000                            52  
00001000                            53  
00001000                            54  
00001000                            55  
00001000                            56  
00001000                            57  
00001000                            58  
00001000                            59  -------------------- end include --------------------
00001000                            60              INCLUDE "CONST.X68"
00001000                            61  ; ==============================================================================
00001000                            62  ; CONSTANTES DE JUEGO
00001000                            63  ; ==============================================================================
00001000                            64  
00001000                            65      ;CONSTANTES ALIEN     
00001000  =0000FF00                 66  ALNFLCLR    EQU     $0000FF00   ;COLOR RELLENO ALIEN
00001000  =0000AA00                 67  ALNPNCLR    EQU     $0000AA00   ;COLOR CONTORNO ALIEN
00001000  =00000028                 68  ALNDIM      EQU     40          ;DIMENSIÓN CUADRADO MAPA ALIEN
00001000  =0000000A                 69  ALNROW      EQU     10          ;FILAS DIBUJO ALIEN
00001000  =0000000A                 70  ALNCOL      EQU     10          ;COLUMNAS DIBUJO ALIEN
00001000  =00000003                 71  ALNMPROW    EQU     3           ;FILAS MAPA ALIEN   
00001000  =0000000A                 72  ALNMPCOL    EQU     10          ;COLUMNAS MAPA ALIEN
00001000  =00000078                 73  ALNIPOSX    EQU     120         ;INICIO POS X ALIENS
00001000  =00000050                 74  ALNIPOSY    EQU     80          ;INICIO POS Y ALIENS
00001000  =00000008                 75  ALNSPD1     EQU     8           ;VELOCIDAD ALIENS NIVEL 1 (NIVEL 3 ES EL DOBLE DE ESTE)
00001000  =0000000C                 76  ALNSPD2     EQU     12          ;VELOCIDAD ALIENS NIVEL 2 (NIVEL 1 * 1,5 PARA QUE EL NIVEL SEA CRECIENTE LINEALMENTE)
00001000  =0000000B                 77  ALNPIXEL    EQU     11          ;PIXELES BAJADA ALIENS (POSY)
00001000                            78  
00001000                            79      ;CONSTANTES TANQUE
00001000  =00FF0000                 80  TNKFLCLR    EQU     $00FF0000   ;COLOR RELLENO TANQUE
00001000  =00AA0000                 81  TNKPNCLR    EQU     $00AA0000   ;COLOR CONTORNO TANQUE
00001000  =00000048                 82  TNKWIDTH    EQU     72          ;ANCHO TANQUE (DIMENSIÓN * COLUMNAS)
00001000  =00000024                 83  TNKWIDHA    EQU     36          ;MITAD ANCHO TANQUE (DIMENSIÓN * COLUMNAS)/2
00001000  =00000008                 84  TNKSQUWI    EQU     8           ;DIMENSIÓN CUADRADO TANQUE 
00001000  =000001A0                 85  TNKPOSY     EQU     416         ;POSICIÓN Y TANQUE (480-64)
00001000  =00000006                 86  TNKROW      EQU     6           ;FILAS MAPA TANQUE
00001000  =00000009                 87  TNKCOL      EQU     9           ;COLUMNAS MAPA TANQUE
00001000  =00000008                 88  TNKSPEED    EQU     8           ;VELOCIDAD TANQUE
00001000                            89  
00001000                            90      ;CONSTANTES DISPARO
00001000  =000000FF                 91  SHTFLCLR    EQU     $000000FF   ;COLOR RELLENO DISPARO
00001000  =000000AA                 92  SHTPNCLR    EQU     $000000AA   ;COLOR CONTORNO DISPARO
00001000  =00000004                 93  SHTWIDTH    EQU     4           ;ANCHO DISPARO
00001000  =00000010                 94  SHTHEIGH    EQU     16          ;ALTURA DISPARO
00001000  =0000000A                 95  SHTGAP      EQU     10          ;ESPACIO TANQUE Y DISPARO
00001000  =0000000A                 96  SHTSPEED    EQU     10          ;VELOCIDAD DISPARO
00001000                            97  
00001000                            98      ;CONSTANTES MARCADOR
00001000  =00000000                 99  SCOFLCLR    EQU     0           ;COLOR RELLENO MARCADOR
00001000  =00FFA500                100  NIVELCR     EQU     $00FFA500   ;COLOR MARCADOR NIVEL
00001000  =0000FF66                101  DISPCLR     EQU     $0000FF66   ;COLOR MARCADOR DISPARO
00001000  =00000101                102  SCOLINE     EQU     $0101       ;COORDENADAS LINEA 1 IZQUIERDA
00001000  =00004101                103  SCOLINE1    EQU     $4101       ;COORDENADAS LINEA 1 DERECHA
00001000  =00004102                104  SCOLINE2    EQU     $4102       ;COORDENADAS LINEA 2 DERECHA
00001000                           105  
00001000                           106      ;CONSTANTES ESTADO
00001000  =FFFFFFFF                107  STANONE     EQU     -1          ;NÚMERO ESTADO NO EXISTENTE
00001000  =00000000                108  STAFLCLR    EQU     0           ;COLOR RELLENO ESTADOS        
00001000                           109  
00001000                           110      ;CONSTANTES VICTORIA
00001000  =0000001E                111  SCOWIN      EQU     30          ; NUMBER OF SCOREBOARD TO VICTORY
00001000                           112  
00001000                           113      ;CONSTANTES NIVELES
00001000  =00000001                114  NIVEL1      EQU     1
00001000  =00000002                115  NIVEL2      EQU     2
00001000  =00000003                116  NIVEL3      EQU     3   
00001000                           117  
00001000                           118  
00001000                           119  
00001000                           120  
00001000                           121  
00001000                           122  
00001000                           123  
00001000                           124  
00001000                           125  
00001000                           126  
00001000                           127  
00001000                           128  
00001000                           129  
00001000                           130  
00001000                           131  
00001000                           132  
00001000                           133  
00001000                           134  
00001000                           135  
00001000                           136  
00001000                           137  
00001000                           138  
00001000                           139  
00001000                           140  
00001000                           141  
00001000                           142  
00001000                           143  
00001000                           144  
00001000                           145  
00001000                           146  
00001000                           147  
00001000                           148  
00001000                           149  
00001000                           150  
00001000                           151  
00001000                           152  
00001000                           153  
00001000                           154  
00001000                           155  
00001000                           156  
00001000                           157  
00001000                           158  
00001000                           159  
00001000                           160  
00001000                           161  
00001000                           162  
00001000                           163  
00001000                           164  
00001000                           165  
00001000                           166  
00001000                           167  
00001000                           168  
00001000                           169  
00001000                           170  
00001000                           171  
00001000                           172  -------------------- end include --------------------
00001000                           173              INCLUDE "LIB/DMMCONST.X68"
00001000                           174  ; =============================================================================
00001000                           175  ; DYNAMIC MEMORY MANAGEMENT CONSTANTS (SYSTEM CONSTANTS)
00001000                           176  ; =============================================================================
00001000                           177  
00001000  =00000040                178  DMMBSIZE    EQU     64                      ; BLOCK SIZE (BYTES). POWER OF TWO
00001000  =00000032                179  DMMBNUM     EQU     50                      ; NUMBER OF BLOCKS
00001000  =00000000                180  DMMSYSID    EQU     0                       ; SYSTEM OWNER ID (MUST BE 0)
00001000  =00000000                181  -------------------- end include --------------------
00001000                           182              INCLUDE "LIB/UTLCONST.X68"
00001000                           183  ; ==============================================================================
00001000                           184  ; UTIL CONSTANTS
00001000                           185  ; ==============================================================================
00001000                           186  
00001000  =00000008                187  UTLCHRWD    EQU     8                       ; CHARACTER WIDTH IN PIXELS
00001000                           188              
00001000                           189  -------------------- end include --------------------
00001000                           190              INCLUDE "LIB/DMMCODE.X68"
00001000                           191  ; =============================================================================
00001000                           192  ; DYNAMIC MEMORY MANAGEMENT (SYSTEM CODE)
00001000                           193  ; DYNAMIC MEMORY IS A SET OF DMMBNUM SLOTS OF DMMBSIZE BYTES EACH ONE.
00001000                           194  ; DMMBSIZE MUST BE POWER OF TWO. A SLOT HAS:
00001000                           195  ; - HEADER - 1 WORD. SPECIFIES THE OWNER (0 MEANS OWNED BY SYSTEM)
00001000                           196  ; - DATA   - DMMBSIZE - 2 BYTES. MAY CONTAIN VARS AND ANY KIND OF DATA RELATED
00001000                           197  ;            THE THE OWNER. IF OWNER==0, DATA IS MEANINGLESS.
00001000                           198  ; =============================================================================
00001000                           199  
00001000                           200  ; -----------------------------------------------------------------------------
00001000                           201  DMMINIT
00001000                           202  ; INITIALIZES THE DYNAMIC MEMORY TO ALL OWNED BY SYSTEM.
00001000                           203  ; INPUT    - NONE
00001000                           204  ; OUTPUT   - NONE
00001000                           205  ; MODIFIES - NONE
00001000                           206  ; -----------------------------------------------------------------------------
00001000  48E7 8080                207              MOVEM.L D0/A0,-(A7)
00001004  41F9 00001FC0            208              LEA     DMMDATA,A0
0000100A  303C 0031                209              MOVE.W  #DMMBNUM-1,D0
0000100E  30BC 0000                210  .LOOP       MOVE.W  #DMMSYSID,(A0)
00001012  D1FC 00000040            211              ADD.L   #DMMBSIZE,A0
00001018  51C8 FFF4                212              DBRA.W  D0,.LOOP
0000101C  4CDF 0101                213              MOVEM.L (A7)+,D0/A0
00001020  4E75                     214              RTS
00001022                           215  
00001022                           216  ; -----------------------------------------------------------------------------
00001022                           217  DMMFIRST
00001022                           218  ; SEARCHES THE FIRST MEMORY SLOT NOT OWNED BY SYSTEM AND OUTPUTS A POINTER
00001022                           219  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00001022                           220  ; INPUT    - NONE
00001022                           221  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00001022                           222  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001022                           223  ; -----------------------------------------------------------------------------
00001022  41F9 00001FC0            224              LEA     DMMDATA,A0
00001028  4A58                     225  DMMFRLOP    TST.W   (A0)+
0000102A  6600 0016                226              BNE     DMMFRFND
0000102E  D1FC 0000003E            227              ADD.L   #DMMBSIZE-2,A0
00001034  B1FC 00002C3F            228  DMMFRCOM    CMP.L   #DMMDATA+DMMBSIZE*DMMBNUM-1,A0
0000103A  6DEC                     229              BLT     DMMFRLOP
0000103C  207C 00000000            230              MOVE.L  #0,A0
00001042  4E75                     231  DMMFRFND    RTS
00001044                           232  
00001044                           233  ; -----------------------------------------------------------------------------
00001044                           234  DMMNEXT
00001044                           235  ; SEARCHES THE NEXT MEMORY SLOT NOT OWNED BY SYSTEM AND OUTPUTS A POINTER
00001044                           236  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00001044                           237  ; INPUT    - A0   : POINTER WITHIN THE CURRENT SLOT
00001044                           238  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00001044                           239  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001044                           240  ; -----------------------------------------------------------------------------
00001044  2F00                     241              MOVE.L  D0,-(A7)
00001046  2008                     242              MOVE.L  A0,D0
00001048  C0BC FFFFFFC0            243              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
0000104E  0680 00000040            244              ADD.L   #DMMBSIZE,D0
00001054  2040                     245              MOVE.L  D0,A0
00001056  201F                     246              MOVE.L  (A7)+,D0
00001058  60DA                     247              BRA     DMMFRCOM
0000105A                           248  
0000105A                           249  ; -----------------------------------------------------------------------------
0000105A                           250  DMMFRSTO
0000105A                           251  ; SEARCHES THE FIRST MEMORY SLOT WITH THE SPECIFIED ID AND OUTPUTS A POINTER
0000105A                           252  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
0000105A                           253  ; INPUT    - D0.W : ID TO SEARCH
0000105A                           254  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
0000105A                           255  ; MODIFIES - NONE (ASIDE OF OUTPUT)
0000105A                           256  ; -----------------------------------------------------------------------------
0000105A  41F9 00001FC0            257              LEA     DMMDATA,A0
00001060  B058                     258  DMMFLOOP    CMP.W   (A0)+,D0
00001062  6700 0016                259              BEQ     DMMFFND
00001066  D1FC 0000003E            260              ADD.L   #DMMBSIZE-2,A0
0000106C  B1FC 00002C3F            261  DMMFCOM     CMP.L   #DMMDATA+DMMBSIZE*DMMBNUM-1,A0
00001072  6DEC                     262              BLT     DMMFLOOP
00001074  207C 00000000            263              MOVE.L  #0,A0
0000107A  4E75                     264  DMMFFND     RTS
0000107C                           265  
0000107C                           266  ; -----------------------------------------------------------------------------
0000107C                           267  DMMNEXTO
0000107C                           268  ; SEARCHES THE NEXT MEMORY SLOT WITH THE SPECIFIED ID AND OUTPUTS A POINTER
0000107C                           269  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
0000107C                           270  ; INPUT    - D0.W : ID TO SEARCH
0000107C                           271  ;            A0   : POINTER WITHIN THE CURRENT SLOT
0000107C                           272  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
0000107C                           273  ; MODIFIES - NONE (ASIDE OF OUTPUT)
0000107C                           274  ; -----------------------------------------------------------------------------
0000107C  2F00                     275              MOVE.L  D0,-(A7)
0000107E  2008                     276              MOVE.L  A0,D0
00001080  C0BC FFFFFFC0            277              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
00001086  0680 00000040            278              ADD.L   #DMMBSIZE,D0
0000108C  2040                     279              MOVE.L  D0,A0
0000108E  201F                     280              MOVE.L  (A7)+,D0
00001090  60DA                     281              BRA     DMMFCOM
00001092                           282  
00001092                           283  ; -----------------------------------------------------------------------------
00001092                           284  DMMALLOC
00001092                           285  ; SEARCHES THE FIRST FREE (SYS OWNED) SLOT, ASSIGNS TO THE SPECIFIED OWNER
00001092                           286  ; AND RETURNS A POINTER TO THE CORRESPONDING DATA (SLOT ADDRESS + 2)
00001092                           287  ; INPUT    - D0.W : ID TO ASSIGN
00001092                           288  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FREE SPACE
00001092                           289  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001092                           290  ; -----------------------------------------------------------------------------
00001092  3F00                     291              MOVE.W  D0,-(A7)
00001094  4240                     292              CLR.W   D0
00001096  4EB8 105A                293              JSR     DMMFRSTO
0000109A  301F                     294              MOVE.W  (A7)+,D0
0000109C  B1FC 00000000            295              CMP.L   #0,A0
000010A2  6700 0006                296              BEQ     .END
000010A6  3140 FFFE                297              MOVE.W  D0,-2(A0)
000010AA  4E75                     298  .END        RTS
000010AC                           299  
000010AC                           300  ; -----------------------------------------------------------------------------
000010AC                           301  DMMFREE
000010AC                           302  ; FREES THE SLOT TO WHICH THE PROVIDED POINTER BELONGS BY SETTING ITS OWNED TO
000010AC                           303  ; SYSTEM (0)
000010AC                           304  ; INPUT    - A0   : POINTER BELONGING TO THE SLOT TO FREE
000010AC                           305  ; OUTPUT   - NONE
000010AC                           306  ; MODIFIES - NONE
000010AC                           307  ; -----------------------------------------------------------------------------
000010AC  48E7 8080                308              MOVEM.L D0/A0,-(A7)
000010B0  2008                     309              MOVE.L  A0,D0
000010B2  C0BC FFFFFFC0            310              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
000010B8  2040                     311              MOVE.L  D0,A0
000010BA  4250                     312              CLR.W   (A0)
000010BC  4CDF 0101                313              MOVEM.L (A7)+,D0/A0
000010C0  4E75                     314              RTS
000010C0  4E75                     315  -------------------- end include --------------------
000010C2                           316              INCLUDE "SYSTEM.X68"
000010C2                           317  ; ==============================================================================
000010C2                           318  ; CLASE SISTEMA
000010C2                           319  ; ==============================================================================
000010C2                           320  ; ------------------------------------------------------------------------------
000010C2                           321  SYSINIT
000010C2                           322  ; INICIALIZA EL SISTEMA
000010C2                           323  ; ------------------------------------------------------------------------------
000010C2                           324              ;INSTALAR TRAPS E INTERRUPCIONES
000010C2  21FC 000011C4 0080       325              MOVE.L  #SCRPLOT,($80+4*SCRUPTN)
000010CA  21FC 000011FA 0084       326              MOVE.L  #KBDUPD,($80+4*KBDUPTN)
000010D2  21FC 0000116E 0088       327              MOVE.L  #SNDPLAY,($80+4*SNDPLTN)
000010DA  21FC 000011DE 0064       328              MOVE.L  #SCRTIM,($64)
000010E2                           329      
000010E2  4EB9 00001180            330              JSR SCRINIT
000010E8  4EB9 000011EC            331              JSR KBDINIT
000010EE  4EB9 000010FC            332              JSR SNDINIT
000010F4                           333      
000010F4  40E7                     334              MOVE.W  SR,-(A7)
000010F6  0257 D8FF                335              ANDI.W  #$D8FF,(A7)
000010FA                           336              
000010FA  4E73                     337              RTE
000010FC                           338           
000010FC                           339  
000010FC                           340  ; ------------------------------------------------------------------------------
000010FC                           341  SNDINIT
000010FC                           342  ; INICIALIZA SISTEMA DE SONIDO
000010FC                           343  ; ------------------------------------------------------------------------------
000010FC  48E7 C0C0                344              MOVEM.L D0-D1/A0-A1,-(A7)
00001100                           345              
00001100  4201                     346              CLR.B   D1
00001102  41F9 0000115A            347              LEA     .SNDLIST,A0
00001108  2018                     348  .LOOP       MOVE.L  (A0)+,D0
0000110A  6700 000E                349              BEQ     .DONE
0000110E  2240                     350              MOVE.L  D0,A1
00001110  103C 0047                351              MOVE.B  #71,D0
00001114  4E4F                     352              TRAP    #15
00001116  5201                     353              ADDQ.B  #1,D1
00001118  60EE                     354              BRA     .LOOP
0000111A                           355              
0000111A  4CDF 0303                356  .DONE       MOVEM.L (A7)+,D0-D1/A0-A1
0000111E  4E75                     357              RTS
00001120                           358              
00001120= 53 4E 44 2F 63 6F ...    359  .SNDCOL     DC.B    'SND/collision.wav',0
00001132= 53 4E 44 2F 69 6E ...    360  .SNDINT     DC.B    'SND/intro.wav',0
00001140= 53 4E 44 2F 77 69 ...    361  .SNDWIN     DC.B    'SND/win.wav',0
0000114C= 53 4E 44 2F 67 6F ...    362  .SNDGOV     DC.B    'SND/gover.wav',0   
0000115A= 00001120 00001132 ...    363  .SNDLIST    DC.L    .SNDCOL,.SNDINT,.SNDWIN,.SNDGOV,0
0000116E                           364  
0000116E                           365  ; ------------------------------------------------------------------------------
0000116E                           366  SNDPLAY
0000116E                           367  ; REPRODUCE EL SONIDO QUE SE LE PASA AL REGISTRO D7.
0000116E                           368  ; ENTRADA  : ID SONIDO (D7)
0000116E                           369  ; ------------------------------------------------------------------------------
0000116E  48A7 C000                370              MOVEM.W D0-D1,-(A7)
00001172                           371              
00001172                           372              ;REPRODUCE EL SONIDO
00001172  103C 0048                373              MOVE.B  #72,D0
00001176  1207                     374              MOVE.B  D7,D1
00001178  4E4F                     375              TRAP    #15
0000117A                           376              
0000117A  4C9F 0003                377              MOVEM.W (A7)+,D0-D1
0000117E  4E73                     378              RTE   
00001180                           379  ; ------------------------------------------------------------------------------
00001180                           380  SCRINIT
00001180                           381  ; INICIALIZA LA PANTALLA. DEFINE LA RESOLUCIÓN DE PANTALLA. MUESTRA PANTALLA EN
00001180                           382  ; MODO VENTANA. HABILITA DOBLE BUFFER.
00001180                           383  ; ------------------------------------------------------------------------------
00001180  48E7 C000                384              MOVEM.L D0-D1,-(A7)
00001184                           385  
00001184                           386              ;DEFINE LA RESOLUCIÓN
00001184  103C 0021                387              MOVE.B  #33,D0
00001188  223C 028001E0            388              MOVE.L  #SCRWIDTH<<16|SCRHEIGH,D1
0000118E  4E4F                     389              TRAP    #15
00001190                           390  
00001190                           391              ;MUESTRA EN MODO VENTANA
00001190  7201                     392              MOVE.L  #1,D1
00001192  4E4F                     393              TRAP    #15
00001194                           394              
00001194                           395              ;VACÍA PANTALLA
00001194  103C 000B                396              MOVE.B  #11,D0
00001198  323C FF00                397              MOVE.W  #$FF00,D1
0000119C  4E4F                     398              TRAP    #15
0000119E                           399              
0000119E                           400              ;HABILITA DOBLE BUFFER
0000119E  103C 005C                401              MOVE.B  #92,D0
000011A2  123C 0011                402              MOVE.B  #17,D1
000011A6  4E4F                     403              TRAP    #15
000011A8                           404              
000011A8                           405              ;HABILITA INTERRUPCIÓN TEMPORIZADA
000011A8  103C 0020                406              MOVE.B  #32,D0
000011AC  123C 0006                407              MOVE.B  #6,D1
000011B0  143C 0081                408              MOVE.B  #$81,D2
000011B4  7614                     409              MOVE.L  #1000/SCRFPS,D3
000011B6  4E4F                     410              TRAP    #15
000011B8                           411              
000011B8                           412              ;INICIALIZA CONTADOR DE INTERRUPCIONES
000011B8  4239 00001F9C            413              CLR.B   (SCRINTCT)
000011BE                           414              
000011BE  4CDF 0003                415              MOVEM.L (A7)+,D0-D1
000011C2  4E75                     416              RTS
000011C4                           417  
000011C4                           418  ; ------------------------------------------------------------------------------
000011C4                           419  SCRPLOT
000011C4                           420  ; ACTUALIZA DOBLE BUFFER
000011C4                           421  ; ------------------------------------------------------------------------------
000011C4  48A7 C000                422              MOVEM.W D0-D1,-(A7)
000011C8                           423              
000011C8                           424              ;CAMBIA BUFFERS
000011C8  103C 005E                425              MOVE.B  #94,D0
000011CC  4E4F                     426              TRAP    #15
000011CE                           427  
000011CE                           428              ;VACÍA BUFFER OCULTO
000011CE  103C 000B                429              MOVE.B  #11,D0
000011D2  323C FF00                430              MOVE.W  #$FF00,D1
000011D6  4E4F                     431              TRAP    #15
000011D8                           432              
000011D8  4C9F 0003                433              MOVEM.W (A7)+,D0-D1
000011DC  4E73                     434              RTE
000011DE                           435              
000011DE                           436  ; ------------------------------------------------------------------------------
000011DE                           437  SCRTIM
000011DE                           438  ; ACTUALIZA CONTADORES
000011DE                           439  ; ------------------------------------------------------------------------------
000011DE  5239 00001F9C            440              ADDQ.B  #1,(SCRINTCT)
000011E4  5239 00001F9D            441              ADDQ.B  #1,(SCRCYCCT)
000011EA  4E73                     442              RTE
000011EC                           443  
000011EC                           444   
000011EC                           445   ; ------------------------------------------------------------------------------
000011EC                           446  KBDINIT
000011EC                           447  ; INICIALIZA LAS VARIABLES DE TECLADO
000011EC                           448  ; ------------------------------------------------------------------------------           
000011EC  4239 00001F9A            449              CLR.B (KBDVAL)
000011F2  4239 00001F9B            450              CLR.B (KBDEDGE)
000011F8  4E75                     451              RTS
000011FA                           452  
000011FA                           453   ; ------------------------------------------------------------------------------
000011FA                           454  KBDUPD
000011FA                           455  ; ACTUALIZA EL TECLADO EN ESTE ORDEN:
000011FA                           456  ; KBDFIRE3 : BIT 7   
000011FA                           457  ; KBDFIRE2 : BIT 6   
000011FA                           458  ; KBDFIRE1 : BIT 5
000011FA                           459  ; KBDSPACE : BIT 4
000011FA                           460  ; KBDLEFT  : BIT 3   
000011FA                           461  ; KBDUP    : BIT 2   
000011FA                           462  ; KBDRIGHT : BIT 1
000011FA                           463  ; KBDDOWN  : BIT 0
000011FA                           464  ; ------------------------------------------------------------------------------   
000011FA  48E7 F000                465              MOVEM.L D0-D3,-(A7)
000011FE                           466              
000011FE                           467              ;LEE PRIMERA PARTE (BITS 4-7)
000011FE  103C 0013                468              MOVE.B  #19,D0
00001202  223C 44534120            469              MOVE.L  #KBDFIRE3<<24|KBDFIRE2<<16|KBDFIRE1<<8|KBDPAUSE,D1
00001208  4E4F                     470              TRAP    #15
0000120A                           471              
0000120A  4EB9 0000123A            472              JSR     .PACK
00001210                           473              
00001210                           474              ;LEE SEGUNDA PARTE (BITS 0-3)
00001210  223C 25262728            475              MOVE.L  #KBDLEFT<<24|KBDUP<<16|KBDRIGHT<<8|KBDDOWN,D1
00001216  4E4F                     476              TRAP    #15
00001218                           477  
00001218  4EB9 0000123A            478              JSR     .PACK
0000121E                           479              
0000121E                           480              ;DEFINIR VARIABLES DE TECLADO
0000121E  1039 00001F9A            481              MOVE.B  (KBDVAL),D0
00001224  4600                     482              NOT.B   D0
00001226  C002                     483              AND.B   D2,D0
00001228  13C0 00001F9B            484              MOVE.B  D0,(KBDEDGE)
0000122E  13C2 00001F9A            485              MOVE.B  D2,(KBDVAL)
00001234                           486              
00001234  4CDF 000F                487              MOVEM.L (A7)+,D0-D3
00001238  4E73                     488              RTE
0000123A                           489              
0000123A                           490              ;CONVIERTE A FORMATO DESEADO
0000123A  363C 0003                491  .PACK       MOVE.W  #3,D3
0000123E  E189                     492  .LOOP       LSL.L   #8,D1
00001240  E312                     493              ROXL.B  #1,D2
00001242  51CB FFFA                494              DBRA.W  D3,.LOOP
00001246  4E75                     495              RTS
00001248                           496  
00001248                           497  
00001248                           498  
00001248                           499  
00001248                           500  
00001248                           501  
00001248                           502  
00001248                           503  
00001248                           504  
00001248                           505  
00001248                           506  
00001248                           507  
00001248                           508  
00001248                           509  
00001248                           510  
00001248                           511  
00001248                           512  
00001248                           513  
00001248                           514  
00001248                           515  -------------------- end include --------------------
00001248                           516              INCLUDE "MACROS.X68"            
00001248                           517  ; ==============================================================================
00001248                           518  ; MACROS
00001248                           519  ; ==============================================================================
00001248                           520      
00001248                           521  ;------------------------------------------------------------------------------
00001248                           522  SET_PEN_COLOR   MACRO
00001248                           523  ; ACTIVA EL COLOR DE CONTORNO PARA DIBUJADO.
00001248                           524  ; INPUT    : \1 COLOR EN FORMATO $00BBGGRR
00001248                           525  ; MODIFICA : D0,D1
00001248                           526  ;------------------------------------------------------------------------------
00001248                           527      MOVEM.L D0-D1,-(A7)
00001248                           528      
00001248                           529      MOVE.B  #80,D0
00001248                           530      MOVE.L  \1,D1
00001248                           531      TRAP    #15
00001248                           532              
00001248                           533      MOVEM.L (A7)+,D0-D1
00001248                           534      ENDM
00001248                           535  
00001248                           536  ;------------------------------------------------------------------------------
00001248                           537  SET_FILL_COLOR  MACRO
00001248                           538  ; ACTIVA EL COLOR DE RELLENO PARA DIBUJADO.
00001248                           539  ; INPUT    : \1 COLOR EN FORMATO $00BBGGRR
00001248                           540  ; MODIFICA : D0,D1
00001248                           541  ;------------------------------------------------------------------------------
00001248                           542      MOVEM.L D0-D1,-(A7)
00001248                           543      
00001248                           544      MOVE.B  #81,D0
00001248                           545      MOVE.L  \1,D1
00001248                           546      TRAP    #15
00001248                           547              
00001248                           548      MOVEM.L (A7)+,D0-D1
00001248                           549      ENDM
00001248                           550  
00001248                           551  
00001248                           552  
00001248                           553  -------------------- end include --------------------
00001248                           554              INCLUDE "LIB/AGLCODE.X68"
00001248                           555  ; =============================================================================
00001248                           556  ; AGENT MANAGEMENT
00001248                           557  ; EACH AGENT HAS A DATA BLOCK FROM DMM AS FOLLOWS:
00001248                           558  ; +0 - LONG : UPDATE SUBROUTINE POINTER
00001248                           559  ; +4 - LONG : PLOT SUBROUTINE POINTER
00001248                           560  ; +8:END    : DATA (AGENT SPECIFIC)
00001248                           561  ; =============================================================================
00001248                           562  
00001248                           563  ; -----------------------------------------------------------------------------
00001248                           564  AGLADD
00001248                           565  ; CREATES A NEW AGENT
00001248                           566  ; INPUT    - A1 - POINTER TO AGENT INIT FUNCTION
00001248                           567  ;            A2 - POINTER TO AGENT UPDATE FUNCTION
00001248                           568  ;            A3 - POINTER TO AGENT PLOT FUNCTION
00001248                           569  ;            D0 - AGENT TYPE (USED AS OWNER BY DMM)
00001248                           570  ;            D1 - AGENT INITIALIZATION PARAMETER 1
00001248                           571  ;            D2 - AGENT INITIALIZATION PARAMETER 2
00001248                           572  ;            D3 - AGENT INITIALIZATION PARAMETER 3
00001248                           573  ; OUTPUT   - NONE
00001248                           574  ; MODIFIES - NONE
00001248                           575  ; -----------------------------------------------------------------------------
00001248  2F08                     576              MOVE.L  A0,-(A7)
0000124A  4EB8 1092                577              JSR     DMMALLOC
0000124E  B1FC 00000000            578              CMP.L   #0,A0
00001254  6700 0008                579              BEQ     .END
00001258  20CA                     580              MOVE.L  A2,(A0)+
0000125A  20CB                     581              MOVE.L  A3,(A0)+
0000125C  4E91                     582              JSR     (A1)
0000125E  205F                     583  .END        MOVE.L  (A7)+,A0
00001260  4E75                     584              RTS
00001262                           585  
00001262                           586  ; -----------------------------------------------------------------------------
00001262                           587  AGLUPD
00001262                           588  ; UPDATES THE AGENT LIST. PRIOR TO CALLING THE UPDATE FUNCTIONS, A0 IS SET
00001262                           589  ; TO THE DATA BLOCK OF THE CORRESPONDING SLOT.
00001262                           590  ; INPUT    - NONE
00001262                           591  ; OUTPUT   - NONE
00001262                           592  ; MODIFIES - NONE
00001262                           593  ; -----------------------------------------------------------------------------
00001262  48E7 00C0                594              MOVEM.L A0-A1,-(A7)
00001266  4EB8 1022                595              JSR     DMMFIRST
0000126A  B1FC 00000000            596  .LOOP       CMP.L   #0,A0
00001270  6700 000E                597              BEQ     .END
00001274  2250                     598              MOVE.L  (A0),A1
00001276  5088                     599              ADD.L   #8,A0
00001278  4E91                     600              JSR     (A1)
0000127A  4EB8 1044                601              JSR     DMMNEXT
0000127E  60EA                     602              BRA     .LOOP
00001280  4CDF 0300                603  .END        MOVEM.L (A7)+,A0-A1
00001284  4E75                     604              RTS
00001286                           605  
00001286                           606  ; -----------------------------------------------------------------------------
00001286                           607  AGLPLOT
00001286                           608  ; PLOTS THE AGENT LIST. PRIOR TO CALLING THE UPDATE FUNCTIONS, A0 IS SET
00001286                           609  ; TO THE DATA BLOCK OF THE CORRESPONDING SLOT.
00001286                           610  ; INPUT    - NONE
00001286                           611  ; OUTPUT   - NONE
00001286                           612  ; MODIFIES - NONE
00001286                           613  ; -----------------------------------------------------------------------------
00001286  48E7 00C0                614              MOVEM.L A0-A1,-(A7)
0000128A  4EB8 1022                615              JSR     DMMFIRST
0000128E  B1FC 00000000            616  .LOOP       CMP.L   #0,A0
00001294  6700 0010                617              BEQ     .END
00001298  2268 0004                618              MOVE.L  4(A0),A1
0000129C  5088                     619              ADD.L   #8,A0
0000129E  4E91                     620              JSR     (A1)
000012A0  4EB8 1044                621              JSR     DMMNEXT
000012A4  60E8                     622              BRA     .LOOP
000012A6  4CDF 0300                623  .END        MOVEM.L (A7)+,A0-A1
000012AA  4E75                     624              RTS
000012AC                           625  
000012AC                           626  ; -----------------------------------------------------------------------------
000012AC  =000010AC                627  AGLKILL     EQU     DMMFREE
000012AC                           628  ; KILLS THE AGENT BY RELEASING ITS MEMORY
000012AC                           629  ; INPUT    - A0 POINTER WITHIN THE AGENT MEMORY
000012AC                           630  ; OUTPUT   - NONE
000012AC                           631  ; MODIFIES - NONE
000012AC                           632  ; NOTE     - IT IS JUST A WRAPPER FOR DMMFREE
000012AC                           633  ; -----------------------------------------------------------------------------
000012AC                           634  -------------------- end include --------------------
000012AC                           635              INCLUDE "LIB/UTLCODE.X68"
000012AC                           636  ; =============================================================================
000012AC                           637  ; UTILITY CODE
000012AC                           638  ; =============================================================================
000012AC                           639  
000012AC                           640  ; -----------------------------------------------------------------------------
000012AC                           641  UTLINIT
000012AC                           642  ; INITIALIZES UTILITY CODE
000012AC                           643  ; INPUT    - NONE
000012AC                           644  ; OUTPUT   - NONE
000012AC                           645  ; MODIFIES - NONE
000012AC                           646  ; -----------------------------------------------------------------------------
000012AC  48E7 C000                647              MOVEM.L D0-D1,-(A7)
000012B0  103C 0008                648              MOVE.B  #8,D0
000012B4  4E4F                     649              TRAP    #15
000012B6  13C1 00001F98            650              MOVE.B  D1,(UTLRNDIX)
000012BC  4CDF 0003                651              MOVEM.L (A7)+,D0-D1
000012C0  4E75                     652              RTS
000012C2                           653              
000012C2                           654  ; -----------------------------------------------------------------------------
000012C2                           655  UTLPRINT
000012C2                           656  ; PRINT SCREEN CENTERED TEXT
000012C2                           657  ; INPUT    : A0 POINTER TO ZERO-TERMINATED STRING
000012C2                           658  ;            D0.B SCREEN ROW TO PRINT TEXT
000012C2                           659  ; OUTPUT   : D0.B NEXT ROW
000012C2                           660  ; MODIFIES : NONE (ASIDE OF OUTPUT)
000012C2                           661  ; -----------------------------------------------------------------------------
000012C2  48E7 C0C0                662              MOVEM.L D0-D1/A0-A1,-(A7)
000012C6  4201                     663              CLR.B   D1
000012C8  2248                     664              MOVE.L  A0,A1
000012CA  4A18                     665  .LOOP       TST.B   (A0)+
000012CC  6700 0006                666              BEQ     .ENDLOOP
000012D0  5201                     667              ADDQ.B  #1,D1
000012D2  60F6                     668              BRA     .LOOP
000012D4  E209                     669  .ENDLOOP    LSR.B   #1,D1
000012D6  0401 0028                670              SUB.B   #(SCRWIDTH/UTLCHRWD)/2,D1
000012DA  4401                     671              NEG.B   D1
000012DC  E141                     672              ASL.W   #8,D1
000012DE  8240                     673              OR.W    D0,D1
000012E0  103C 000B                674              MOVE.B  #11,D0
000012E4  4E4F                     675              TRAP    #15
000012E6  103C 000D                676              MOVE.B  #13,D0
000012EA  4E4F                     677              TRAP    #15
000012EC  4CDF 0303                678              MOVEM.L (A7)+,D0-D1/A0-A1
000012F0  5200                     679              ADDQ.B  #1,D0
000012F2  4E75                     680              RTS
000012F4                           681  
000012F4                           682  
000012F4                           683  ; -----------------------------------------------------------------------------
000012F4                           684  UTLRAND
000012F4                           685  ; PROVIDES A PSEUDO-RANDOM BYTE
000012F4                           686  ; INPUT    - NONE
000012F4                           687  ; OUTPUT   - D0.L RANDOM VALUE (ONLY BYTE)
000012F4                           688  ; MODIFIES - NONE (ASIDE OF OUTPUT)
000012F4                           689  ; -----------------------------------------------------------------------------
000012F4  2F08                     690              MOVE.L  A0,-(A7)
000012F6  41F9 00001312            691              LEA     .RANDVEC,A0
000012FC  4280                     692              CLR.L   D0
000012FE  1039 00001F98            693              MOVE.B  (UTLRNDIX),D0
00001304  1030 0800                694              MOVE.B  (A0,D0.L),D0
00001308  5239 00001F98            695              ADDQ.B  #1,(UTLRNDIX)
0000130E  205F                     696              MOVE.L  (A7)+,A0
00001310  4E75                     697              RTS
00001312                           698  
00001312                           699  
00001312= A2 EE 9A 0C F5 24 ...    700  .RANDVEC    DC.B    162, 238, 154, 12 , 245, 36 , 32 , 103
0000131A= 2A A3 51 26 E0 AC ...    701              DC.B    42 , 163, 81 , 38 , 224, 172, 19 , 69
00001322= 75 51 CA FD 33 EB ...    702              DC.B    117, 81 , 202, 253, 51 , 235, 108, 154
0000132A= 60 CC E7 B8 9A EB ...    703              DC.B    96 , 204, 231, 184, 154, 235, 34 , 203
00001332= 1D 76 B5 95 B0 89 ...    704              DC.B    29 , 118, 181, 149, 176, 137, 62 , 108
0000133A= 39 15 48 C9 6E CA ...    705              DC.B    57 , 21 , 72 , 201, 110, 202, 159, 41
00001342= 43 E7 E2 7C 37 25 ...    706              DC.B    67 , 231, 226, 124, 55 , 37 , 84 , 62
0000134A= E9 94 CE E9 E4 52 ...    707              DC.B    233, 148, 206, 233, 228, 82 , 243, 78
00001352= 37 6D 9A 84 A2 28 ...    708              DC.B    55 , 109, 154, 132, 162, 40 , 30 , 39
0000135A= 19 E2 C6 77 80 D4 ...    709              DC.B    25 , 226, 198, 119, 128, 212, 232, 225
00001362= 0A 5A 32 67 33 C2 ...    710              DC.B    10 , 90 , 50 , 103, 51 , 194, 222, 40
0000136A= 59 80 DC 0E 57 FC ...    711              DC.B    89 , 128, 220, 14 , 87 , 252, 243, 252
00001372= 8A AB BC F7 07 4D ...    712              DC.B    138, 171, 188, 247, 7  , 77 , 29 , 234
0000137A= EF D5 77 6E 1E BB ...    713              DC.B    239, 213, 119, 110, 30 , 187, 131, 23
00001382= D6 E0 2A 8F BD 28 ...    714              DC.B    214, 224, 42 , 143, 189, 40 , 212, 130
0000138A= 13 4F 66 EC 0A 64 ...    715              DC.B    19 , 79 , 102, 236, 10 , 100, 122, 188
00001392= 56 52 9A 16 9B 90 ...    716              DC.B    86 , 82 , 154, 22 , 155, 144, 7  , 199
0000139A= 06 8A A4 F7 01 DA ...    717              DC.B    6  , 138, 164, 247, 1  , 218, 166, 82
000013A2= F2 E7 77 28 B1 76 ...    718              DC.B    242, 231, 119, 40 , 177, 118, 220, 102
000013AA= A4 42 E3 81 B1 67 ...    719              DC.B    164, 66 , 227, 129, 177, 103, 165, 108
000013B2= BF CE FA 16 BF 38 ...    720              DC.B    191, 206, 250, 22 , 191, 56 , 30 , 161
000013BA= D1 8B 50 0C 5F 49 ...    721              DC.B    209, 139, 80 , 12 , 95 , 73 , 168, 56
000013C2= DE 4C 14 A2 40 DC ...    722              DC.B    222, 76 , 20 , 162, 64 , 220, 93 , 12
000013CA= B6 9B 0A 38 5D AB ...    723              DC.B    182, 155, 10 , 56 , 93 , 171, 89 , 6
000013D2= E2 1B DD 75 15 82 ...    724              DC.B    226, 27 , 221, 117, 21 , 130, 101, 18
000013DA= 8A 26 51 30 9F 47 ...    725              DC.B    138, 38 , 81 , 48 , 159, 71 , 57 , 21
000013E2= 1E 8A BB 71 C6 6E ...    726              DC.B    30 , 138, 187, 113, 198, 110, 185, 152
000013EA= 9F 47 E5 34 94 27 ...    727              DC.B    159, 71 , 229, 52 , 148, 39 , 77 , 6
000013F2= 7D 06 D6 BA 30 0F ...    728              DC.B    125, 6  , 214, 186, 48 , 15 , 212, 22
000013FA= EC 7F 7E 03 CF 2D ...    729              DC.B    236, 127, 126, 3  , 207, 45 , 193, 2
00001402= 94 5B 23 F2 8B CD ...    730              DC.B    148, 91 , 35 , 242, 139, 205, 248, 237
0000140A= 74 33 EC B9 0F D5 ...    731              DC.B    116, 51 , 236, 185, 15 , 213, 221, 6
00001412                           732  
00001412                           733  -------------------- end include --------------------
00001412                           734              INCLUDE "TANK.X68"
00001412                           735  ; ==============================================================================
00001412                           736  ; CLASE TANQUE
00001412                           737  ; ==============================================================================
00001412                           738    
00001412                           739  ; ------------------------------------------------------------------------------
00001412                           740  TNKINIT
00001412                           741  ; INICIALIZA TANQUE. ELIMINA SONIDO DE PRESENTACIÓN (TANTO PARA DEMO COMO PARA
00001412                           742  ; JUEGO).
00001412                           743  ; ------------------------------------------------------------------------------
00001412  48E7 E000                744              MOVEM.L D0-D2,-(A7)           
00001416                           745  
00001416                           746              ;QUITAR SONIDO PRESENTACIÓN
00001416  103C 004C                747              MOVE.B  #76,D0
0000141A  1207                     748              MOVE.B  D7,D1 
0000141C  7402                     749              MOVE.L  #2,D2
0000141E  4E4F                     750              TRAP    #15
00001420                           751              
00001420                           752              ;INICIALIZAR POSICIÓN X TANQUE (MITAD PANTALLA - MITAD ANCHO TANQUE)
00001420  33FC 011C 00001F7E       753              MOVE.W  #SCRWIDTH/2-TNKWIDHA,(TNKPOSX) 
00001428                           754              
00001428  4CDF 0007                755              MOVEM.L (A7)+,D0-D2
0000142C  4E75                     756              RTS
0000142E                           757              
0000142E                           758  ; ------------------------------------------------------------------------------
0000142E                           759  TNKUPD
0000142E                           760  ; ACTUALIZA LAS COORDENADAS DEL TANQUE. COMPRUEBA COLISIONES CON EXTREMOS DE LA
0000142E                           761  ; PANTALLA.
0000142E                           762  ; ------------------------------------------------------------------------------
0000142E  3F00                     763              MOVE.W D0,-(A7)
00001430                           764              
00001430                           765              ;GUARDAR VARIABLE EN REGISTRO
00001430  3039 00001F7E            766              MOVE.W  (TNKPOSX),D0        
00001436                           767              
00001436                           768              ;MOVER DERECHA SI TECLA: ->
00001436  0839 0001 00001F9A       769              BTST.B  #1,(KBDVAL)
0000143E  6700 0004                770              BEQ     .LEFT
00001442  5040                     771              ADD.W   #TNKSPEED,D0
00001444                           772             
00001444                           773              ;MOVER IZQUIERDA SI TECLA: <-
00001444  0839 0003 00001F9A       774  .LEFT       BTST.B  #3,(KBDVAL)
0000144C  6700 0004                775              BEQ     .CHKLEFT
00001450  5140                     776              SUB.W   #TNKSPEED,D0
00001452                           777                
00001452                           778              ;COMPOBAR COLISIONES PANTALLA
00001452                           779              ;COMPROBAR COLISIÓN IZQUIERDA
00001452  B07C 0000                780  .CHKLEFT    CMP.W   #0,D0
00001456  6C00 0008                781              BGE     .CHKRIGHT
0000145A  4240                     782              CLR.W   D0                          ;LO COLOCA A LA IZQUIERDA
0000145C  6000 000E                783              BRA     .DONE
00001460                           784  
00001460                           785              ;COMPROBAR COLISIÓN DERECHA
00001460  B07C 0238                786  .CHKRIGHT   CMP.W   #SCRWIDTH-TNKWIDTH,D0     
00001464  6F00 0006                787              BLE     .DONE
00001468  303C 0238                788              MOVE.W  #SCRWIDTH-TNKWIDTH,D0       ;LO COLOCA A LA DERECHA     
0000146C                           789              
0000146C                           790              ;ACTUALIZAR VARIABLE
0000146C  33C0 00001F7E            791  .DONE       MOVE.W  D0,(TNKPOSX)
00001472                           792  
00001472  301F                     793              MOVE.W (A7)+,D0
00001474  4E75                     794              RTS
00001476                           795  
00001476                           796  ; ------------------------------------------------------------------------------
00001476                           797  TNKPLOT
00001476                           798  ; DIBUJA EL TANQUE EN PANTALLA.
00001476                           799  ; ------------------------------------------------------------------------------
00001476  48E7 FE80                800              MOVEM.L D0-D6/A0,-(A7)
0000147A                           801              
0000147A                           802              ;ESTABLECER COLOR CONTORNO
0000147A                           803m             SET_PEN_COLOR #TNKPNCLR
0000147A                           804m ; ACTIVA EL COLOR DE CONTORNO PARA DIBUJADO.
0000147A                           805m ; INPUT    : #TNKPNCLR COLOR EN FORMATO $00BBGGRR
0000147A                           806m ; MODIFICA : D0,D1
0000147A                           807m ;------------------------------------------------------------------------------
0000148E                           808  
0000148E                           809              ;ESTABLECER COLOR RELLENO
0000148E                           810m             SET_FILL_COLOR  #TNKFLCLR
0000148E                           811m ; ACTIVA EL COLOR DE RELLENO PARA DIBUJADO.
0000148E                           812m ; INPUT    : #TNKFLCLR COLOR EN FORMATO $00BBGGRR
0000148E                           813m ; MODIFICA : D0,D1
0000148E                           814m ;------------------------------------------------------------------------------
000014A2                           815              
000014A2                           816              ;DIBUJAR TANQUE EN FORMATO MATRIZ
000014A2  43F9 000014E4            817              LEA     TNKMAP,A1
000014A8  103C 0057                818              MOVE.B  #87,D0
000014AC  343C 01A0                819              MOVE.W  #TNKPOSY,D2
000014B0  383C 01A8                820              MOVE.W  #TNKPOSY+TNKSQUWI,D4                ;DEFINIR POSICIÓN Y
000014B4  3C3C 0005                821              MOVE.W  #TNKROW-1,D6                        ;FILAS MATRIZ
000014B8  3239 00001F7E            822  .CLOOP      MOVE.W  (TNKPOSX),D1
000014BE  3601                     823              MOVE.W  D1,D3
000014C0  5043                     824              ADD.W   #TNKSQUWI,D3                        ;DEFINIR POSICIÓN X
000014C2  3A3C 0008                825              MOVE.W  #TNKCOL-1,D5                        ;COLUMNAS MATRIZ
000014C6  4A19                     826  .RLOOP      TST.B   (A1)+
000014C8  6700 0004                827              BEQ     .NEXT
000014CC  4E4F                     828              TRAP    #15
000014CE  3203                     829  .NEXT       MOVE.W  D3,D1
000014D0  5043                     830              ADD.W   #TNKSQUWI,D3
000014D2  51CD FFF2                831              DBRA.W  D5,.RLOOP
000014D6  3404                     832              MOVE.W  D4,D2
000014D8  5044                     833              ADD.W   #TNKSQUWI,D4
000014DA  51CE FFDC                834              DBRA.W  D6,.CLOOP
000014DE                           835  
000014DE  4CDF 027F                836              MOVEM.L (A7)+,D0-D6/A1
000014E2  4E75                     837              RTS
000014E4                           838              
000014E4                           839              ;FIGURA TANQUE EN MATRIZ 6x9
000014E4= 00 00 00 00 01 00 ...    840  TNKMAP      DC.B    0,0,0,0,1,0,0,0,0    
000014ED= 00 00 00 01 01 01 ...    841              DC.B    0,0,0,1,1,1,0,0,0
000014F6= 00 00 00 01 01 01 ...    842              DC.B    0,0,0,1,1,1,0,0,0
000014FF= 01 01 01 01 01 01 ...    843              DC.B    1,1,1,1,1,1,1,1,1
00001508= 01 01 01 01 01 01 ...    844              DC.B    1,1,1,1,1,1,1,1,1
00001511= 01 01 01 01 01 01 ...    845              DC.B    1,1,1,1,1,1,1,1,1
0000151A                           846              DS.W    0
0000151A                           847  
0000151A                           848  
0000151A                           849  
0000151A                           850  
0000151A                           851  
0000151A                           852  
0000151A                           853  
0000151A                           854  
0000151A                           855  
0000151A                           856  
0000151A                           857  
0000151A                           858  
0000151A                           859  
0000151A                           860  
0000151A                           861  
0000151A                           862  
0000151A                           863  
0000151A                           864  
0000151A                           865  
0000151A                           866  
0000151A                           867  
0000151A                           868  
0000151A                           869  
0000151A                           870  
0000151A                           871  
0000151A                           872  -------------------- end include --------------------
0000151A                           873              INCLUDE "ALIEN.X68"
0000151A                           874  ; ==============================================================================
0000151A                           875  ; CLASE ALIEN
0000151A                           876  ; ==============================================================================
0000151A                           877  ; ------------------------------------------------------------------------------
0000151A                           878  ALNINIT
0000151A                           879  ; INICIALIZA COORDENADAS ALIEN. RELLENA EL MAPA DE ALIENS.
0000151A                           880  ; ------------------------------------------------------------------------------
0000151A  33FC 0078 00001F80       881              MOVE.W  #ALNIPOSX,(ALNPOSX)
00001522  33FC 0050 00001F82       882              MOVE.W  #ALNIPOSY,(ALNPOSY)
0000152A  33FC 0008 00001F84       883              MOVE.W  #ALNSPD1,(ALNVELX)      ;VELOCIDAD NIVEL 1
00001532  33FC 000C 00001F86       884              MOVE.W  #ALNSPD2,(ALNVELX2)     ;VELOCIDAD NIVEL 2
0000153A  33FC 000B 00001F88       885              MOVE.W  #ALNPIXEL,(ALNVELY)
00001542  4EB9 00001736            886              JSR     MAPPLOT       
00001548  4E75                     887              RTS
0000154A                           888  
0000154A                           889  ; ------------------------------------------------------------------------------
0000154A                           890  ALNUPD
0000154A                           891  ; ACTUALIZA EL MOVIMIENTO DE LOS ALIENS.
0000154A                           892  ; ------------------------------------------------------------------------------
0000154A  48E7 C000                893              MOVEM.L D0-D1,-(A7)
0000154E                           894              
0000154E                           895              ;GUARDA COORDENADAS
0000154E  3039 00001F80            896              MOVE.W  (ALNPOSX),D0
00001554  3239 00001F82            897              MOVE.W  (ALNPOSY),D1
0000155A                           898              
0000155A                           899              ;MIRAR EN QUÉ RANGO ESTÁ POS(Y)
0000155A                           900              ;PARA DETERMINAR EL NIVEL DE DIFICULTAD
0000155A  B27C 0090                901              CMP.W   #144,D1             ;SIGUIENTE NIVEL SI ES MÁS GRANDE
0000155E  6D00 000E                902              BLT     .LVL1
00001562  B27C 00D0                903              CMP.W   #208,D1             ;SIGUIENTE NIVEL SI ES MÁS GRANDE
00001566  6D00 0018                904              BLT     .LVL2
0000156A  6000 0026                905              BRA     .LVL3   
0000156E                           906              
0000156E                           907              ;NIVEL 1
0000156E  33FC 0001 00001F92       908  .LVL1       MOVE.W  #NIVEL1,(SCOLEVEL)
00001576  D079 00001F84            909              ADD.W   (ALNVELX),D0        ;VELOCIDAD ESTÁNDAR
0000157C  6000 0028                910              BRA     .CHKCOL
00001580                           911              
00001580                           912              ;NIVEL 2
00001580  33FC 0002 00001F92       913  .LVL2       MOVE.W  #NIVEL2,(SCOLEVEL)
00001588  D079 00001F86            914              ADD.W   (ALNVELX2),D0       ;1,5 VECES MÁS RÁPIDO
0000158E  6000 0016                915              BRA     .CHKCOL
00001592                           916  
00001592                           917              ;NIVEL 3
00001592  33FC 0003 00001F92       918  .LVL3       MOVE.W  #NIVEL3,(SCOLEVEL)
0000159A  D079 00001F84            919              ADD.W   (ALNVELX),D0
000015A0  D079 00001F84            920              ADD.W   (ALNVELX),D0        ;DOBLE MÁS RÁPIDO        
000015A6                           921                  
000015A6                           922              ;COMPRUEBA COLISIONES HORIZONTALES
000015A6  B07C 00C8                923  .CHKCOL     CMP.W   #SCRWIDTH-440,D0    ;EXTREMO DERECHO (DEJAMOS UN MARGÉN)
000015AA  6E00 000E                924              BGT     .COLRGT
000015AE  B07C 0028                925              CMP.W   #ALNDIM,D0          ;EXTREMO IZQUIERDO
000015B2  6D00 0020                926              BLT     .COLLFT
000015B6  6000 0032                927              BRA     .DONE
000015BA                           928              
000015BA                           929              ;COMPRUEBA COLISIONES LATERALES DERECHA
000015BA  D279 00001F88            930  .COLRGT     ADD.W   (ALNVELY),D1        ;BAJAR N PIXELES HACIA ABAJO
000015C0  4479 00001F84            931              NEG.W   (ALNVELX)           ;MOVER HACIA LA OTRA DIRECCIÓN
000015C6  4479 00001F86            932              NEG.W   (ALNVELX2)
000015CC  303C 00C8                933              MOVE.W  #SCRWIDTH-440,D0    ;VOLVER A ESA POSICIÓN SI SE HA PASADO
000015D0  6000 0018                934              BRA     .DONE
000015D4                           935              
000015D4                           936              ;COMPRUEBA COLISIONES LATERALES IZQUIERDA
000015D4  D279 00001F88            937  .COLLFT     ADD.W   (ALNVELY),D1        ;BAJAR N PIXELES HACIA ABAJO
000015DA  4479 00001F84            938              NEG.W   (ALNVELX)           ;MOVER HACIA LA OTRA DIRECCIÓN
000015E0  4479 00001F86            939              NEG.W   (ALNVELX2)
000015E6  303C 0028                940              MOVE.W  #ALNDIM,D0          ;VOLVER A ESA POSICIÓN SI SE HA PASADO
000015EA                           941        
000015EA                           942              ;ESTABLECE COORDENADAS
000015EA  33C0 00001F80            943  .DONE       MOVE.W  D0,(ALNPOSX)
000015F0  33C1 00001F82            944              MOVE.W  D1,(ALNPOSY)
000015F6                           945  
000015F6  4CDF 0003                946              MOVEM.L (A7)+,D0-D1 
000015FA  4E75                     947              RTS
000015FC                           948  
000015FC                           949  ;--------------------------------------------------------------------------------
000015FC                           950  ALNPLOT
000015FC                           951  ; DIBUJA UNA CUADRICULA 3*10 PARA QUE HAYA UN ALIEN EN CADA UNA DE ELLAS.
000015FC                           952  ;--------------------------------------------------------------------------------
000015FC  48E7 7E20                953              MOVEM.L D1-D6/A2,-(A7)
00001600                           954                  
00001600                           955              ;DEFINE COLORES
00001600                           956m             SET_PEN_COLOR   #ALNPNCLR
00001600                           957m ; ACTIVA EL COLOR DE CONTORNO PARA DIBUJADO.
00001600                           958m ; INPUT    : #ALNPNCLR COLOR EN FORMATO $00BBGGRR
00001600                           959m ; MODIFICA : D0,D1
00001600                           960m ;------------------------------------------------------------------------------
00001614                           961m             SET_FILL_COLOR  #ALNFLCLR
00001614                           962m ; ACTIVA EL COLOR DE RELLENO PARA DIBUJADO.
00001614                           963m ; INPUT    : #ALNFLCLR COLOR EN FORMATO $00BBGGRR
00001614                           964m ; MODIFICA : D0,D1
00001614                           965m ;------------------------------------------------------------------------------
00001628                           966              
00001628                           967              ;CARGA MAPA
00001628  45F9 00001674            968              LEA     MAPDATA,A2      
0000162E                           969              
0000162E                           970              ;DIBUJA CUADRÍCULA 3*10 CON ALIEN INCLUIDO
0000162E  3439 00001F82            971              MOVE.W  (ALNPOSY),D2
00001634  3802                     972              MOVE.W  D2,D4
00001636  0644 0028                973              ADD.W   #ALNDIM,D4          ;POSICIÓN Y
0000163A  3C3C 0002                974              MOVE.W  #ALNMPROW-1,D6      ;FILAS MAPA
0000163E  3239 00001F80            975  .CLOOP      MOVE.W  (ALNPOSX),D1
00001644  3601                     976              MOVE.W  D1,D3
00001646  0643 0028                977              ADD.W   #ALNDIM,D3          ;POSICIÓN X
0000164A  3A3C 0009                978              MOVE.W  #ALNMPCOL-1,D5      ;COLUMNAS MAPA
0000164E  4A1A                     979  .RLOOP      TST.B   (A2)+
00001650  6700 0008                980              BEQ     .NEXT
00001654  4EB9 00001692            981              JSR     ALNMPLOT            ;DIBUJA ALIEN
0000165A  3203                     982  .NEXT       MOVE.W  D3,D1
0000165C  0643 0028                983              ADD.W   #ALNDIM,D3
00001660  51CD FFEC                984              DBRA.W  D5,.RLOOP
00001664  3404                     985              MOVE.W  D4,D2
00001666  0644 0028                986              ADD.W   #ALNDIM,D4
0000166A  51CE FFD2                987              DBRA.W  D6,.CLOOP
0000166E                           988  
0000166E  4CDF 047E                989              MOVEM.L (A7)+,D1-D6/A2
00001672  4E75                     990              RTS   
00001674                           991   
00001674                           992              ;MATRIZ 3*10
00001674= 01 01 01 01 01 01 ...    993  MAPDATA     DC.B    1,1,1,1,1,1,1,1,1,1
0000167E= 01 01 01 01 01 01 ...    994              DC.B    1,1,1,1,1,1,1,1,1,1
00001688= 01 01 01 01 01 01 ...    995              DC.B    1,1,1,1,1,1,1,1,1,1
00001692                           996              DS.W    0
00001692                           997  
00001692                           998  ; ------------------------------------------------------------------------------
00001692                           999  ALNMPLOT
00001692                          1000  ; DIBUJA EL ALIEN EN FORMATO MATRIZ (MAPA DE BITS)
00001692                          1001  ; ------------------------------------------------------------------------------
00001692  48E7 FF40               1002              MOVEM.L D0-D7/A1,-(A7)
00001696                          1003              
00001696                          1004              ;GUARDA REGISTRO
00001696  3E01                    1005              MOVE.W  D1,D7                                     
00001698                          1006              
00001698                          1007              ;CARGA MAPA
00001698  43F9 000016D2           1008              LEA     ALNDATA,A1
0000169E                          1009              
0000169E                          1010              ;DIBUJA ALIEN EN FORMATO MATRIZ
0000169E  103C 0057               1011              MOVE.B  #87,D0
000016A2  3802                    1012              MOVE.W  D2,D4
000016A4  5844                    1013              ADD.W   #ALNDIM/ALNROW,D4           ;POSICIÓN Y
000016A6  3C3C 0009               1014              MOVE.W  #ALNROW-1,D6                ;FILAS ALIEN             
000016AA  3207                    1015  .CLOOP1     MOVE.W  D7,D1                       ;RESTAURA REGISTRO
000016AC  3601                    1016              MOVE.W  D1,D3
000016AE  5843                    1017              ADD.W   #ALNDIM/ALNROW,D3           ;POSICIÓN X    
000016B0  3A3C 0009               1018              MOVE.W  #ALNCOL-1,D5                ;COLUMNAS ALIEN                   
000016B4  4A19                    1019  .RLOOP1     TST.B   (A1)+
000016B6  6700 0004               1020              BEQ     .NEXT1
000016BA  4E4F                    1021              TRAP    #15
000016BC  3203                    1022  .NEXT1      MOVE.W  D3,D1
000016BE  5843                    1023              ADD.W   #ALNDIM/ALNROW,D3
000016C0  51CD FFF2               1024              DBRA.W  D5,.RLOOP1
000016C4  3404                    1025              MOVE.W  D4,D2
000016C6  5844                    1026              ADD.W   #ALNDIM/ALNROW,D4
000016C8  51CE FFE0               1027              DBRA.W  D6,.CLOOP1
000016CC                          1028  
000016CC  4CDF 02FF               1029              MOVEM.L (A7)+,D0-D7/A1
000016D0  4E75                    1030              RTS
000016D2                          1031  
000016D2                          1032              ;FIGURA DE ALIEN ('0's REPRESENTAN ESPACIOS ENTRE ALIENS)
000016D2= 00 00 00 00 00 00 ...   1033  ALNDATA     DC.B    0,0,0,0,0,0,0,0,0,0
000016DC= 00 00 00 00 00 00 ...   1034              DC.B    0,0,0,0,0,0,0,0,0,0
000016E6= 00 00 00 01 01 01 ...   1035              DC.B    0,0,0,1,1,1,1,0,0,0
000016F0= 00 00 01 01 01 01 ...   1036              DC.B    0,0,1,1,1,1,1,1,0,0
000016FA= 00 00 01 00 01 01 ...   1037              DC.B    0,0,1,0,1,1,0,1,0,0
00001704= 00 00 01 01 00 00 ...   1038              DC.B    0,0,1,1,0,0,1,1,0,0
0000170E= 00 00 00 01 01 01 ...   1039              DC.B    0,0,0,1,1,1,1,0,0,0
00001718= 00 00 01 00 00 00 ...   1040              DC.B    0,0,1,0,0,0,0,1,0,0
00001722= 00 00 00 00 00 00 ...   1041              DC.B    0,0,0,0,0,0,0,0,0,0
0000172C= 00 00 00 00 00 00 ...   1042              DC.B    0,0,0,0,0,0,0,0,0,0
00001736                          1043              DS.W    0
00001736                          1044  
00001736                          1045  
00001736                          1046  ; ------------------------------------------------------------------------------
00001736                          1047  MAPPLOT
00001736                          1048  ; RELLENA EL MAPDATA 
00001736                          1049  ; ------------------------------------------------------------------------------
00001736  48E7 6040               1050              MOVEM.L D1-D2/A1,-(A7)
0000173A                          1051              
0000173A  43F8 1674               1052              LEA     MAPDATA,A1         
0000173E  7201                    1053              MOVEQ   #1,D1              
00001740  741D                    1054              MOVEQ   #ALNMPROW*ALNMPCOL-1,D2             
00001742                          1055  
00001742                          1056  RESET_LOOP
00001742                          1057              ;ESTABLECER EL VALOR EN LA UBICACIÓN ACTUAL Y AVANZAR
00001742  12C1                    1058              MOVE.B  D1,(A1)+  
00001744                          1059  
00001744                          1060              ;DECREMENTAR D2 Y SALTAR SI NO HA ALCANZADO LA LONGITUD TOTAL        
00001744  51CA FFFC               1061              DBRA    D2,RESET_LOOP 
00001748                          1062  
00001748  4CDF 0206               1063              MOVEM.L (A7)+,D1-D2/A1
0000174C  4E75                    1064              RTS  
0000174E                          1065  
0000174E                          1066  
0000174E                          1067  
0000174E                          1068  
0000174E                          1069  
0000174E                          1070       
0000174E                          1071  
0000174E                          1072  
0000174E                          1073  
0000174E                          1074  
0000174E                          1075  
0000174E                          1076  
0000174E                          1077  
0000174E                          1078  
0000174E                          1079  
0000174E                          1080  
0000174E                          1081  
0000174E                          1082  
0000174E                          1083  
0000174E                          1084  
0000174E                          1085  
0000174E                          1086  
0000174E                          1087  
0000174E                          1088  
0000174E                          1089  
0000174E                          1090  
0000174E                          1091  
0000174E                          1092  
0000174E                          1093  
0000174E                          1094  
0000174E                          1095  
0000174E                          1096  
0000174E                          1097  
0000174E                          1098  
0000174E                          1099  
0000174E                          1100  
0000174E                          1101  
0000174E                          1102  
0000174E                          1103  
0000174E                          1104  
0000174E                          1105  
0000174E                          1106  
0000174E                          1107  
0000174E                          1108  
0000174E                          1109  
0000174E                          1110  
0000174E                          1111  
0000174E                          1112  
0000174E                          1113  
0000174E                          1114  
0000174E                          1115  
0000174E                          1116  
0000174E                          1117  
0000174E                          1118  
0000174E                          1119  
0000174E                          1120  
0000174E                          1121  
0000174E                          1122  
0000174E                          1123  
0000174E                          1124  
0000174E                          1125  -------------------- end include --------------------
0000174E                          1126              INCLUDE "SHOT.X68"
0000174E                          1127  ; ==============================================================================
0000174E                          1128  ; CLASE DISPARO (AGENTE)
0000174E                          1129  ; SHTPOSX (W) : (A0)
0000174E                          1130  ; SHTPOSY (W) : 2(A0)
0000174E                          1131  ; ==============================================================================
0000174E                          1132  
0000174E                          1133  ; ------------------------------------------------------------------------------
0000174E                          1134  SHTINIT
0000174E                          1135  ; POSICIONA LAS COORDENADAS DEL DISPARO.
0000174E                          1136  ; ENTRADA  : PUNTERO A LAS VARIABLES INSTANCIADAS (A0)
0000174E                          1137  ; ------------------------------------------------------------------------------
0000174E                          1138              ;POSICIONAR X RESPECTO AL TANQUE
0000174E  30B9 00001F7E           1139              MOVE.W  (TNKPOSX),(A0)
00001754  0650 0024               1140              ADD.W   #TNKWIDHA,(A0)
00001758                          1141              
00001758                          1142              ;POSICIONAR Y RESPECTO AL TANQUE
00001758  317C 01A0 0002          1143              MOVE.W  #TNKPOSY,2(A0)
0000175E  0468 0012 0002          1144              SUB.W   #SHTGAP+SHTHEIGH/2,2(A0)  
00001764  4E75                    1145              RTS
00001766                          1146   
00001766                          1147  ; ------------------------------------------------------------------------------
00001766                          1148  SHTUPD
00001766                          1149  ; ACTUALIZA EL DISPARO. ELIMINA DISPAROS. COMPRUEBA COLISIONES CON ALIEN.
00001766                          1150  ; ELIMINA LOS ALIENS COLISIONADOS.
00001766                          1151  ; ENTRADA  : PUNTERO A LAS VARIABLES INSTANCIADAS (A0)
00001766                          1152  ; ------------------------------------------------------------------------------
00001766  48E7 C000               1153              MOVEM.L  D0-D1,-(A7)
0000176A  48A7 3800               1154              MOVEM.W  D2-D4,-(A7)            
0000176E                          1155      
0000176E                          1156              ;ACTUALIZA MOVIMIENTO DISPARO
0000176E  3028 0002               1157              MOVE.W  2(A0),D0
00001772  0440 000A               1158              SUB.W   #SHTSPEED,D0
00001776  3140 0002               1159              MOVE.W  D0,2(A0)
0000177A                          1160              
0000177A                          1161              ;ELIMINA DISPARO SI TOCA TECHO
0000177A  0641 0010               1162              ADD.W   #SHTHEIGH,D1
0000177E  E249                    1163              LSR.W   #1,D1
00001780  D041                    1164              ADD.W   D1,D0
00001782  B07C 0000               1165              CMP.W   #LIMIT,D0
00001786  6E00 0006               1166              BGT     .NEXT
0000178A  4EB8 10AC               1167              JSR     AGLKILL
0000178E                          1168              
0000178E                          1169              ;COMPOBAR COLISIONES CON ALIENS
0000178E                          1170              ;COMPROBAR COLISIÓN DISPARO X IZQUIERDA  
0000178E  3039 00001F80           1171  .NEXT       MOVE.W  (ALNPOSX),D0        ;D0 = ALNPOSX 
00001794  343C 0004               1172              MOVE.W  #SHTWIDTH,D2
00001798  E24A                    1173              LSR.W   #1,D2
0000179A  D450                    1174              ADD.W   (A0),D2             ;SHTPOSX + SHTWIDTH/2
0000179C  B440                    1175              CMP.W   D0,D2             
0000179E  6D00 00A8               1176              BLT     .DONE
000017A2                          1177              
000017A2                          1178              ;COMPROBAR COLISIÓN DISPARO X DERECHA
000017A2  343C 0004               1179              MOVE.W  #SHTWIDTH,D2
000017A6  E24A                    1180              LSR.W   #1,D2
000017A8  9450                    1181              SUB.W   (A0),D2            
000017AA  4442                    1182              NEG.W   D2                  ;SHTPOSX - SHTWIDTH/2
000017AC  3600                    1183              MOVE.W  D0,D3               ;COPIAR ALNPOSX
000017AE  0643 0190               1184              ADD.W   #ALNDIM*ALNMPCOL,D3 ;ALNPOSX + ALNDIM * ALNMPCOL
000017B2  B443                    1185              CMP.W   D3,D2
000017B4  6E00 0092               1186              BGT     .DONE
000017B8                          1187              
000017B8                          1188              ;COMPROBAR COLISIÓN DISPARO Y ARRIBA
000017B8  3239 00001F82           1189              MOVE.W  (ALNPOSY),D1        ;D1 = ALNPOSY
000017BE  343C 0010               1190              MOVE.W  #SHTHEIGH,D2
000017C2  E24A                    1191              LSR.W   #1,D2
000017C4  D468 0002               1192              ADD.W   2(A0),D2            ;SHTPOSY + SHTHEIGH/2 
000017C8  B441                    1193              CMP.W   D1,D2              
000017CA  6D00 007C               1194              BLT     .DONE
000017CE                          1195              
000017CE                          1196              ;COMPROBAR COLISIÓN DISPARO Y ABAJO
000017CE  343C 0010               1197              MOVE.W  #SHTHEIGH,D2
000017D2  E24A                    1198              LSR.W   #1,D2
000017D4  9468 0002               1199              SUB.W   2(A0),D2         
000017D8  4442                    1200              NEG.W   D2                  ;SHTPOSY - SHTHEIGH/2
000017DA  3601                    1201              MOVE.W  D1,D3               ;COPIAR ALNPOSY
000017DC  0643 0078               1202              ADD.W   #ALNDIM*ALNMPROW,D3 ;ALNPOSY + ALNDIM * ALNMPROW
000017E0  B443                    1203              CMP.W   D3,D2
000017E2  6C00 0064               1204              BGE     .DONE
000017E6                          1205              
000017E6                          1206              
000017E6                          1207              ;HAY COLISIÓN, COMPROBAMOS QUÉ ALIEN ES
000017E6                          1208              ;DETERMINAMOS LA COLUMNA
000017E6  303C 0004               1209              MOVE.W  #SHTWIDTH,D0
000017EA  E248                    1210              LSR.W   #1,D0
000017EC  9050                    1211              SUB.W   (A0),D0 
000017EE  4440                    1212              NEG.W   D0                  ;D0 = SHTPOSX-SHTWIDTH/2 (PARTE IZQUIERDA DISPARO)
000017F0  3239 00001F80           1213              MOVE.W  (ALNPOSX),D1        ;D1 = ALNPOSX
000017F6  9041                    1214              SUB.W   D1,D0               ;D0 = (SHTPOSX-SHTWIDTH/2)-ALNPOSX
000017F8  80FC 0028               1215              DIVU.W  #ALNDIM,D0          ;COLUMNA DE LA MATRIZ
000017FC  3800                    1216              MOVE.W  D0,D4
000017FE  4280                    1217              CLR.L   D0                  ;EL RESTO DE DIVU NO NOS INTERESA
00001800  3004                    1218              MOVE.W  D4,D0
00001802                          1219                                      
00001802                          1220              ;DETERMINAMOS LA FILA
00001802  323C 0010               1221              MOVE.W  #SHTHEIGH,D1
00001806  E249                    1222              LSR.W   #1,D1
00001808  9268 0002               1223              SUB.W   2(A0),D1    
0000180C  4441                    1224              NEG.W   D1                  ;D1 = SHTPOSY-SHTHEIGH/2 (PARTE ARRIBA DISPARO)
0000180E  3639 00001F82           1225              MOVE.W  (ALNPOSY),D3        ;D3 = ALNPOSY
00001814  9243                    1226              SUB.W   D3,D1               ;D1 = (SHTPOSY-SHTHEIGH/2)-ALNPOSY
00001816  82FC 0028               1227              DIVU.W  #ALNDIM,D1          ;FILA DE LA MATRIZ
0000181A  3401                    1228              MOVE.W  D1,D2
0000181C  4281                    1229              CLR.L   D1                  ;EL RESTO DE DIVU NO NOS INTERESA
0000181E                          1230              
0000181E                          1231              ;DETERMINAMOS LA POSICIÓN EN LA MATRIZ
0000181E  C4FC 000A               1232              MULU.W  #10,D2              ;D2 = ÍNDICE FILA * 10
00001822  D042                    1233              ADD.W   D2,D0               ;D0 = D2 + ÍNDICE COLUMNA                
00001824                          1234              
00001824                          1235              ;MIRAMOS SI ESTÁ VIVO EL ALIEN
00001824  47F8 1674               1236              LEA     MAPDATA,A3
00001828  0C33 0001 0000          1237              CMP.B   #1,(A3,D0.W)          
0000182E  6600 0018               1238              BNE     .DONE
00001832                          1239              
00001832                          1240              ;ALIEN VIVO
00001832  0233 0000 0000          1241              AND.B   #0,(A3,D0.W)        ;DESAPARECE EL ALIEN
00001838  5279 00001F8E           1242              ADDQ.W  #1,(SCOPOINT)       ;INCREMENTAMOS LOS PUNTOS ACUMULADOS           
0000183E  4EB8 10AC               1243              JSR     AGLKILL             ;ELIMINA DISPARO
00001842  1E3C 0000               1244              MOVE.B  #SNDSHT,D7         
00001846  4E42                    1245              TRAP    #SNDPLTN            ;REPRODUCE SONIDO DE COLISIÓN
00001848                          1246              
00001848  4C9F 001C               1247  .DONE       MOVEM.W  (A7)+,D2-D4
0000184C  4CDF 0003               1248              MOVEM.L  (A7)+,D0-D1
00001850  4E75                    1249              RTS
00001852                          1250  
00001852                          1251  ; ------------------------------------------------------------------------------
00001852                          1252  SHTPLOT
00001852                          1253  ; ACTUALIZA EL DISPARO
00001852                          1254  ; ENTRADA  : PUNTERO A LAS VARIABLES INSTANCIADAS (A0)
00001852                          1255  ; ------------------------------------------------------------------------------
00001852  48E7 F800               1256              MOVEM.L D0-D4,-(A7)
00001856                          1257              
00001856                          1258              ;ESTABLECER COLOR CONTORNO
00001856                          1259m             SET_PEN_COLOR   #SHTPNCLR            
00001856                          1260m ; ACTIVA EL COLOR DE CONTORNO PARA DIBUJADO.
00001856                          1261m ; INPUT    : #SHTPNCLR COLOR EN FORMATO $00BBGGRR
00001856                          1262m ; MODIFICA : D0,D1
00001856                          1263m ;------------------------------------------------------------------------------
0000186A                          1264              ;ESTABLECER COLOR RELLENO
0000186A                          1265m             SET_FILL_COLOR  #SHTFLCLR
0000186A                          1266m ; ACTIVA EL COLOR DE RELLENO PARA DIBUJADO.
0000186A                          1267m ; INPUT    : #SHTFLCLR COLOR EN FORMATO $00BBGGRR
0000186A                          1268m ; MODIFICA : D0,D1
0000186A                          1269m ;------------------------------------------------------------------------------
0000187E                          1270            
0000187E                          1271              ;DIBUJAR DISPARO (RECTANGULO)
0000187E  3210                    1272              MOVE.W  (A0),D1
00001880  3428 0002               1273              MOVE.W  2(A0),D2
00001884  5541                    1274              SUB.W   #SHTWIDTH/2,D1
00001886  3601                    1275              MOVE.W  D1,D3
00001888  5843                    1276              ADD.W   #SHTWIDTH,D3
0000188A  5042                    1277              ADD.W   #SHTHEIGH/2,D2   
0000188C  3802                    1278              MOVE.W  D2,D4
0000188E  0444 0010               1279              SUB.W   #SHTHEIGH,D4
00001892  103C 0057               1280              MOVE.B  #87,D0
00001896  4E4F                    1281              TRAP    #15
00001898                          1282              
00001898  4CDF 001F               1283              MOVEM.L (A7)+,D0-D4
0000189C  4E75                    1284              RTS        
0000189E                          1285  
0000189E                          1286  
0000189E                          1287  
0000189E                          1288  
0000189E                          1289  
0000189E                          1290  
0000189E                          1291  
0000189E                          1292  
0000189E                          1293  
0000189E                          1294  
0000189E                          1295  
0000189E                          1296  
0000189E                          1297  
0000189E                          1298  
0000189E                          1299  
0000189E                          1300  
0000189E                          1301  
0000189E                          1302  
0000189E                          1303  
0000189E                          1304  
0000189E                          1305  
0000189E                          1306  
0000189E                          1307  
0000189E                          1308  
0000189E                          1309  
0000189E                          1310  
0000189E                          1311  
0000189E                          1312  
0000189E                          1313  
0000189E                          1314  
0000189E                          1315  
0000189E                          1316  
0000189E                          1317  
0000189E                          1318  
0000189E                          1319  
0000189E                          1320  
0000189E                          1321  
0000189E                          1322  
0000189E                          1323  
0000189E                          1324  
0000189E                          1325  
0000189E                          1326  
0000189E                          1327  
0000189E                          1328  
0000189E                          1329  
0000189E                          1330  
0000189E                          1331  
0000189E                          1332  
0000189E                          1333  
0000189E                          1334  
0000189E                          1335  
0000189E                          1336  
0000189E                          1337  
0000189E                          1338  
0000189E                          1339  
0000189E                          1340  
0000189E                          1341  
0000189E                          1342  
0000189E                          1343  
0000189E                          1344  
0000189E                          1345  -------------------- end include --------------------
0000189E                          1346              INCLUDE "SCORE.X68"
0000189E                          1347  ; ==============================================================================
0000189E                          1348  ; CLASE MARCADOR
0000189E                          1349  ; ==============================================================================
0000189E                          1350  
0000189E                          1351  ; ------------------------------------------------------------------------------
0000189E                          1352  SCOINIT
0000189E                          1353  ; INICIALIZA LOS MARCADORES
0000189E                          1354  ; ------------------------------------------------------------------------------
0000189E  4279 00001F8E           1355              CLR.W   (SCOPOINT)
000018A4  4279 00001F90           1356              CLR.W   (SCOSHOOT)
000018AA  4279 00001F92           1357              CLR.W   (SCOLEVEL)
000018B0  4E75                    1358              RTS
000018B2                          1359   
000018B2                          1360  ; ------------------------------------------------------------------------------
000018B2                          1361  SCOPLOT
000018B2                          1362  ; MUESTRA LOS MARCADORES
000018B2                          1363  ; ------------------------------------------------------------------------------
000018B2  48E7 C040               1364              MOVEM.L D0-D1/A1,-(A7)
000018B6                          1365              
000018B6                          1366              ;ESTABLECER COLOR RELLENO
000018B6                          1367m             SET_FILL_COLOR  #SCOFLCLR
000018B6                          1368m ; ACTIVA EL COLOR DE RELLENO PARA DIBUJADO.
000018B6                          1369m ; INPUT    : #SCOFLCLR COLOR EN FORMATO $00BBGGRR
000018B6                          1370m ; MODIFICA : D0,D1
000018B6                          1371m ;------------------------------------------------------------------------------
000018C6                          1372              
000018C6                          1373              ;ESTABLECE POSICIÓN 1 IZQUIERDA
000018C6  103C 000B               1374              MOVE.B  #11,D0
000018CA  323C 0101               1375              MOVE.W  #SCOLINE,D1
000018CE  4E4F                    1376              TRAP    #15
000018D0                          1377              
000018D0                          1378              ;MUESTRA PUNTUACIÓN
000018D0  103C 0011               1379              MOVE.B  #17,D0
000018D4  43F9 00001948           1380              LEA     .TXT,A1
000018DA  3239 00001F8E           1381              MOVE.W  (SCOPOINT),D1
000018E0  4E4F                    1382              TRAP    #15
000018E2                          1383              
000018E2                          1384              ;ESTABLECE POSICIÓN 1 DERECHA 
000018E2  103C 000B               1385              MOVE.B  #11,D0
000018E6  323C 4101               1386              MOVE.W  #SCOLINE1,D1
000018EA  4E4F                    1387              TRAP    #15
000018EC                          1388              
000018EC                          1389              ;MUESTRA NÚMERO DE DISPAROS
000018EC                          1390m             SET_PEN_COLOR   #DISPCLR
000018EC                          1391m ; ACTIVA EL COLOR DE CONTORNO PARA DIBUJADO.
000018EC                          1392m ; INPUT    : #DISPCLR COLOR EN FORMATO $00BBGGRR
000018EC                          1393m ; MODIFICA : D0,D1
000018EC                          1394m ;------------------------------------------------------------------------------
00001900  103C 0011               1395              MOVE.B  #17,D0
00001904  43F9 00001954           1396              LEA     .TXT1,A1
0000190A  3239 00001F90           1397              MOVE.W  (SCOSHOOT),D1
00001910  4E4F                    1398              TRAP    #15    
00001912                          1399              
00001912                          1400              ;ESTABLECER POSICIÓN 2 DERECHA 
00001912  103C 000B               1401              MOVE.B  #11,D0
00001916  323C 4102               1402              MOVE.W  #SCOLINE2,D1
0000191A  4E4F                    1403              TRAP    #15
0000191C                          1404              
0000191C                          1405              ;MUESTRA NIVEL DE DIFICULTAD
0000191C                          1406m             SET_PEN_COLOR   #NIVELCR
0000191C                          1407m ; ACTIVA EL COLOR DE CONTORNO PARA DIBUJADO.
0000191C                          1408m ; INPUT    : #NIVELCR COLOR EN FORMATO $00BBGGRR
0000191C                          1409m ; MODIFICA : D0,D1
0000191C                          1410m ;------------------------------------------------------------------------------
00001930  103C 0011               1411              MOVE.B  #17,D0
00001934  43F9 0000195E           1412              LEA     .TXT2,A1
0000193A  3239 00001F92           1413              MOVE.W  (SCOLEVEL),D1
00001940  4E4F                    1414              TRAP    #15  
00001942                          1415              
00001942  4CDF 0203               1416              MOVEM.L (A7)+,D0-D1/A1
00001946  4E75                    1417              RTS
00001948                          1418  
00001948= 50 55 4E 54 55 41 ...   1419  .TXT        DC.B    'PUNTUACION:',0    
00001954= 44 49 53 50 41 52 ...   1420  .TXT1       DC.B    'DISPAROS:',0  
0000195E= 4E 49 56 45 4C 3A 00    1421  .TXT2       DC.B    'NIVEL:',0   
00001966                          1422              DS.W    0 
00001966                          1423  
00001966                          1424  
00001966                          1425  
00001966                          1426  
00001966                          1427  
00001966                          1428  
00001966                          1429  
00001966                          1430  
00001966                          1431  
00001966                          1432  -------------------- end include --------------------
00001966                          1433              INCLUDE "FILE.X68"
00001966                          1434  ; ==============================================================================
00001966                          1435  ; CLASE FICHERO (SE USA PARA LA DEMO)
00001966                          1436  ; ==============================================================================
00001966                          1437  
00001966                          1438  ; ------------------------------------------------------------------------------
00001966                          1439  FILINIT
00001966                          1440  ; INICIALIZA EL FICHERO (DEMO)
00001966                          1441  ; ------------------------------------------------------------------------------
00001966  48E7 8040               1442              MOVEM.L D0/A1,-(A7)
0000196A                          1443              
0000196A                          1444              ;ABRIR EL FICHERO
0000196A  103C 0033               1445              MOVE.B  #51,D0
0000196E  43F9 0000197C           1446              LEA     .FILE,A1
00001974  4E4F                    1447              TRAP    #15  
00001976                          1448              
00001976  4CDF 0201               1449  .DONE       MOVEM.L (A7)+,D0/A1
0000197A  4E75                    1450              RTS
0000197C                          1451  
0000197C= 46 49 43 2F 66 69 ...   1452  .FILE       DC.B    'FIC/fichero.txt',0
0000198C                          1453              DS.W    0    
0000198C                          1454  
0000198C                          1455  ; ------------------------------------------------------------------------------
0000198C                          1456  FILUPD
0000198C                          1457  ; LEE FICHERO ENTERO Y ACTUALIZA MOVIMIENTOS/DISPARO (DEMO)
0000198C                          1458  ; ------------------------------------------------------------------------------
0000198C  48E7 F040               1459              MOVEM.L D0-D3/A1,-(A7)
00001990                          1460              
00001990                          1461              ;DATOS LECTURA FICHERO
00001990  103C 0035               1462              MOVE.B  #53,D0
00001994  7401                    1463              MOVE.L  #1,D2
00001996  43F9 000019EC           1464              LEA     .BUFFER,A1
0000199C  4E4F                    1465              TRAP    #15
0000199E                          1466              
0000199E                          1467              ;LEER EL FICHERO
0000199E  0411 0030               1468              SUB.B   #$30,(A1)               ;CONVERTIR ASCII A REAL
000019A2  1611                    1469              MOVE.B  (A1),D3
000019A4  4A03                    1470              TST.B   D3                      ;FICHERO ACABA EN 0
000019A6  6700 003E               1471              BEQ     .DONE
000019AA  5289                    1472              ADDQ.L  #1,A1                   ;PASA A SIGUIENTE BIT
000019AC                          1473              
000019AC                          1474              ;ESPERAR 10 ms ENTRE UNA ACCIÓN Y LA SIGUIENTE
000019AC  103C 0017               1475              MOVE.B  #23,D0
000019B0  7201                    1476              MOVE.L  #1,D1
000019B2  4E4F                    1477              TRAP    #15
000019B4                          1478              
000019B4                          1479              ;MIRAR QUÉ BIT ES
000019B4  B63C 0001               1480              CMP.B   #1,D3
000019B8  6600 000C               1481              BNE     .NEXT1
000019BC  4EB9 00001A12           1482              JSR     TNKRIGHT                ;MOVER TANQUE DERECHA SI BIT = 1
000019C2  6000 0022               1483              BRA     .DONE
000019C6                          1484           
000019C6  B63C 0003               1485  .NEXT1      CMP.B   #3,D3
000019CA  6600 000C               1486              BNE     .NEXT2
000019CE  4EB9 00001A32           1487              JSR     TNKLEFT                 ;MOVER TANQUE IZQUIERDA SI BIT = 3
000019D4  6000 0010               1488              BRA     .DONE
000019D8                          1489              
000019D8  B63C 0002               1490  .NEXT2      CMP.B   #2,D3
000019DC  6600 0008               1491              BNE     .DONE
000019E0  4EB9 000019EE           1492              JSR     SHTADD                  ;AGREGAR DISPARO SI BIT = 2
000019E6                          1493              
000019E6  4CDF 020F               1494  .DONE       MOVEM.L (A7)+,D0-D3/A1
000019EA  4E75                    1495              RTS  
000019EC                          1496              
000019EC                          1497  .BUFFER     DS.B    1       
000019EE                          1498              DS.W    0
000019EE                          1499  
000019EE                          1500  ; ------------------------------------------------------------------------------
000019EE                          1501  SHTADD
000019EE                          1502  ; AGREGA EL DISPARO (DEMO)
000019EE                          1503  ; ------------------------------------------------------------------------------
000019EE  48E7 8070               1504              MOVEM.L D0/A1-A3,-(A7)
000019F2                          1505              
000019F2  43F8 174E               1506              LEA     SHTINIT,A1
000019F6  45F8 1766               1507              LEA     SHTUPD,A2
000019FA  47F8 1852               1508              LEA     SHTPLOT,A3
000019FE  303C 0001               1509              MOVE.W  #1,D0
00001A02  4EB8 1248               1510              JSR     AGLADD
00001A06  5279 00001F90           1511              ADD.W   #1,(SCOSHOOT)           ;SUMA A LA PUNTUACIÓN
00001A0C                          1512              
00001A0C  4CDF 0E01               1513              MOVEM.L (A7)+,D0/A1-A3
00001A10  4E75                    1514              RTS
00001A12                          1515  
00001A12                          1516  ; ------------------------------------------------------------------------------
00001A12                          1517  TNKRIGHT
00001A12                          1518  ; MUEVE TANQUE A LA DERECHA (DEMO)
00001A12                          1519  ; ------------------------------------------------------------------------------
00001A12  3F00                    1520              MOVE.W  D0,-(A7)
00001A14                          1521              
00001A14                          1522              ;GUARDAR VARIABLE EN REGISTRO
00001A14  3039 00001F7E           1523              MOVE.W  (TNKPOSX),D0        
00001A1A                          1524              
00001A1A                          1525              ;MOVER TANQUE A LA DERECHA
00001A1A  5040                    1526              ADD.W   #TNKSPEED,D0       
00001A1C                          1527  
00001A1C                          1528              ;COMPROBAR COLISIÓN DERECHA
00001A1C  B07C 0238               1529              CMP.W   #SCRWIDTH-TNKWIDTH,D0     
00001A20  6F00 0006               1530              BLE     .DONE
00001A24  303C 0238               1531              MOVE.W  #SCRWIDTH-TNKWIDTH,D0     ;RESTA ANCHO DEL TANQUE     
00001A28                          1532              
00001A28                          1533              ;ACTUALIZAR VARIABLE
00001A28  33C0 00001F7E           1534  .DONE       MOVE.W  D0,(TNKPOSX)
00001A2E                          1535              
00001A2E  301F                    1536              MOVE.W (A7)+,D0
00001A30  4E75                    1537              RTS
00001A32                          1538              
00001A32                          1539  ; ------------------------------------------------------------------------------
00001A32                          1540  TNKLEFT
00001A32                          1541  ; MUEVE TANQUE A LA IZQUIERDA (DEMO)
00001A32                          1542  ; ------------------------------------------------------------------------------
00001A32  3F00                    1543              MOVE.W D0,-(A7)
00001A34                          1544              
00001A34                          1545              ;GUARDAR VARIABLE EN REGISTRO
00001A34  3039 00001F7E           1546              MOVE.W  (TNKPOSX),D0        
00001A3A                          1547                       
00001A3A                          1548              ;MOVER TANQUE A LA IZQUIERDA 
00001A3A  5140                    1549              SUB.W   #TNKSPEED,D0
00001A3C                          1550  
00001A3C                          1551              ;COMPROBAR COLISIÓN IZQUIERDA
00001A3C  B07C 0000               1552              CMP.W   #0,D0
00001A40  6C00 0004               1553              BGE     .DONE
00001A44  4240                    1554              CLR.W   D0       
00001A46                          1555              
00001A46                          1556              ;ACTUALIZAR VARIABLE
00001A46  33C0 00001F7E           1557  .DONE       MOVE.W  D0,(TNKPOSX)
00001A4C                          1558  
00001A4C  301F                    1559              MOVE.W (A7)+,D0
00001A4E  4E75                    1560              RTS
00001A50                          1561  
00001A50                          1562  
00001A50                          1563  
00001A50                          1564  
00001A50                          1565  
00001A50                          1566  
00001A50                          1567  
00001A50                          1568  -------------------- end include --------------------
00001A50                          1569              INCLUDE "STATES.X68"
00001A50                          1570  ; =============================================================================
00001A50                          1571  ; GESTIÓN DE ESTADOS
00001A50                          1572  ; =============================================================================
00001A50                          1573  
00001A50                          1574  ; -----------------------------------------------------------------------------
00001A50                          1575  STAINIT
00001A50                          1576  ; INICIALIZA LAS VARIABLES DE GESTIÓN DE ESTADOS
00001A50                          1577  ; -----------------------------------------------------------------------------
00001A50  33FC FFFF 00001F94      1578              MOVE.W  #STANONE,(STACUR)
00001A58  4279 00001F96           1579              CLR.W   (STANEXT)
00001A5E  4E75                    1580              RTS
00001A60                          1581  
00001A60                          1582  ; -----------------------------------------------------------------------------
00001A60                          1583  STAUPD
00001A60                          1584  ; ACTUALIZA LA GESTIÓN DE ESTADOS
00001A60                          1585  ; -----------------------------------------------------------------------------
00001A60  48E7 8080               1586              MOVEM.L D0/A0,-(A7)
00001A64                          1587              
00001A64  4280                    1588              CLR.L   D0
00001A66  3039 00001F96           1589              MOVE.W  (STANEXT),D0
00001A6C  B079 00001F94           1590              CMP.W   (STACUR),D0
00001A72  6700 0012               1591              BEQ     .DOUPD
00001A76  33C0 00001F94           1592              MOVE.W  D0,(STACUR)             ;REALIZA EL INIT 
00001A7C  E588                    1593              LSL.L   #2,D0
00001A7E  2040                    1594              MOVE.L  D0,A0
00001A80  2068 1A9E               1595              MOVE.L  .INITBL(A0),A0
00001A84  4E90                    1596              JSR     (A0)
00001A86  4280                    1597  .DOUPD      CLR.L   D0                      ;SI NO, REALIZA EL UPDATE
00001A88  3039 00001F94           1598              MOVE.W  (STACUR),D0
00001A8E  E588                    1599              LSL.L   #2,D0
00001A90  2040                    1600              MOVE.L  D0,A0
00001A92  2068 1AB2               1601              MOVE.L  .UPDTBL(A0),A0
00001A96  4E90                    1602              JSR     (A0)
00001A98                          1603              
00001A98  4CDF 0101               1604              MOVEM.L (A7)+,D0/A0
00001A9C  4E75                    1605              RTS
00001A9E                          1606              
00001A9E= 00001AF8 00001CDC ...   1607  .INITBL     DC.L    INTINIT,DEMINIT,GAMINIT,WININIT,GOVINIT
00001AB2= 00001B12 00001CF0 ...   1608  .UPDTBL     DC.L    INTUPD,DEMUPD,GAMUPD,WINUPD,GOVUPD
00001AC6                          1609  
00001AC6                          1610  ; -----------------------------------------------------------------------------
00001AC6                          1611  STAPLOT
00001AC6                          1612  ; DIBUJA EL ESTADO ACTUAL
00001AC6                          1613  ; -----------------------------------------------------------------------------
00001AC6  48E7 8080               1614              MOVEM.L D0/A0,-(A7)
00001ACA                          1615              
00001ACA  4280                    1616              CLR.L   D0
00001ACC  3039 00001F94           1617              MOVE.W  (STACUR),D0
00001AD2  E588                    1618              LSL.L   #2,D0
00001AD4  2040                    1619              MOVE.L  D0,A0
00001AD6  2068 1AE2               1620              MOVE.L  .PLTTBL(A0),A0
00001ADA  4E90                    1621              JSR     (A0)
00001ADC                          1622              
00001ADC  4CDF 0101               1623              MOVEM.L (A7)+,D0/A0
00001AE0  4E75                    1624              RTS
00001AE2                          1625              
00001AE2= 00001B40 00001D28 ...   1626  .PLTTBL     DC.L    INTPLOT,DEMPLOT,GAMPLOT,WINPLOT,GOVPLOT
00001AF6                          1627  
00001AF6                          1628  ; -----------------------------------------------------------------------------
00001AF6                          1629  STAEMPTY
00001AF6                          1630  ; SUBRUTINA QUE FUNCIONA COMO ESTADO VACÍO. NO HACE NADA.
00001AF6                          1631  ; -----------------------------------------------------------------------------
00001AF6  4E75                    1632              RTS
00001AF8                          1633  
00001AF8                          1634  
00001AF8                          1635  
00001AF8                          1636  
00001AF8                          1637  
00001AF8                          1638  
00001AF8                          1639  
00001AF8                          1640  
00001AF8                          1641  
00001AF8                          1642  
00001AF8                          1643  
00001AF8                          1644  
00001AF8                          1645  
00001AF8                          1646  
00001AF8                          1647  -------------------- end include --------------------
00001AF8                          1648              INCLUDE "INTRO.X68" 
00001AF8                          1649  ; ==============================================================================
00001AF8                          1650  ; PANTALLA DE INTRODUCCIÓN
00001AF8                          1651  ; ==============================================================================
00001AF8                          1652  
00001AF8                          1653  ; ------------------------------------------------------------------------------
00001AF8                          1654  INTINIT 
00001AF8                          1655  ; INICIALIZA INTRO. REPRODUCE EL SONIDO.
00001AF8                          1656  ; ------------------------------------------------------------------------------        
00001AF8  48E7 E000               1657              MOVEM.L D0-D2,-(A7)
00001AFC                          1658              
00001AFC                          1659              ;QUITA SONIDO ANTERIOR
00001AFC  103C 004C               1660              MOVE.B  #76,D0
00001B00  1207                    1661              MOVE.B  D7,D1 
00001B02  7402                    1662              MOVE.L  #2,D2
00001B04  4E4F                    1663              TRAP    #15         
00001B06                          1664  
00001B06                          1665              ;REALIZA SONIDO INTRO
00001B06  1E3C 0001               1666              MOVE.B  #SNDDEM,D7  
00001B0A  4E42                    1667              TRAP    #SNDPLTN  
00001B0C                          1668              
00001B0C  4CDF 0007               1669              MOVEM.L (A7)+,D0-D2
00001B10  4E75                    1670              RTS
00001B12                          1671  ; ------------------------------------------------------------------------------
00001B12                          1672  INTUPD
00001B12                          1673  ; ACTUALIZA PANTALLA DE INTRODUCCIÓN
00001B12                          1674  ; ------------------------------------------------------------------------------
00001B12                          1675              ;PASA SIGUIENTE ESTADO 
00001B12  0839 0000 00001F9B      1676              BTST.B  #0,(KBDEDGE)    ;SI SE PULSA TECLA HACIA ABAJO
00001B1A  6700 000E               1677              BEQ     .CONT
00001B1E  33FC 0002 00001F96      1678              MOVE.W  #2,(STANEXT)    ;PASA A JUEGO
00001B26  6000 0016               1679              BRA     .DONE
00001B2A  0839 0004 00001F9B      1680  .CONT       BTST.B  #4,(KBDEDGE)    ;SI SE PULSA ESPACIO
00001B32  6700 000A               1681              BEQ     .DONE
00001B36  33FC 0001 00001F96      1682              MOVE.W  #1,(STANEXT)    ;VUELVE A INTRO
00001B3E  4E75                    1683  .DONE       RTS
00001B40                          1684  
00001B40                          1685  ; ------------------------------------------------------------------------------
00001B40                          1686  INTPLOT
00001B40                          1687  ; DIBUJA PANTALLA DE INTRODUCCIÓN. SE INTRODUCE EL JUEGO AL USUARIO MEDIANTE 
00001B40                          1688  ; TEXTO INFORMATIVO.
00001B40                          1689  ; ------------------------------------------------------------------------------
00001B40  48E7 C080               1690              MOVEM.L D0-D1/A0,-(A7)
00001B44                          1691  
00001B44                          1692              ;ESTABLECE COLOR RELLENO
00001B44                          1693m             SET_FILL_COLOR  #STAFLCLR
00001B44                          1694m ; ACTIVA EL COLOR DE RELLENO PARA DIBUJADO.
00001B44                          1695m ; INPUT    : #STAFLCLR COLOR EN FORMATO $00BBGGRR
00001B44                          1696m ; MODIFICA : D0,D1
00001B44                          1697m ;------------------------------------------------------------------------------
00001B54                          1698              
00001B54                          1699              ;DIBUJA LAS LINEAS DE TEXTO EN PANTALLA
00001B54  41F9 00001BDE           1700              LEA     .TXT1,A0
00001B5A  103C 0005               1701              MOVE.B  #5,D0
00001B5E  4EB8 12C2               1702              JSR     UTLPRINT
00001B62                          1703              
00001B62  41F9 00001BED           1704              LEA     .TXT2,A0
00001B68  103C 000A               1705              MOVE.B  #10,D0
00001B6C  4EB8 12C2               1706              JSR     UTLPRINT
00001B70                          1707              
00001B70  41F9 00001BFB           1708              LEA     .TXT3,A0
00001B76  4EB8 12C2               1709              JSR     UTLPRINT
00001B7A                          1710              
00001B7A  41F9 00001C19           1711              LEA     .TXT4,A0
00001B80  4EB8 12C2               1712              JSR     UTLPRINT
00001B84                          1713              
00001B84  41F9 00001C36           1714              LEA     .TXT5,A0
00001B8A  4EB8 12C2               1715              JSR     UTLPRINT
00001B8E                          1716                       
00001B8E  41F9 00001C4C           1717              LEA     .TXT6,A0
00001B94  103C 0010               1718              MOVE.B  #16,D0
00001B98  4EB8 12C2               1719              JSR     UTLPRINT
00001B9C                          1720              
00001B9C  41F9 00001C52           1721              LEA     .TXT7,A0
00001BA2  4EB8 12C2               1722              JSR     UTLPRINT
00001BA6                          1723              
00001BA6  41F9 00001C81           1724              LEA     .TXT8,A0
00001BAC  4EB8 12C2               1725              JSR     UTLPRINT     
00001BB0                          1726              
00001BB0                          1727              ;LOS SIGUIENTES TEXTOS PARPADEAN
00001BB0  0839 0004 00001F9D      1728              BTST.B  #4,(SCRCYCCT)
00001BB8  6700 001E               1729              BEQ     .DONE
00001BBC                          1730              
00001BBC  41F9 00001C9F           1731              LEA     .TXT9,A0
00001BC2  103C 0016               1732              MOVE.B  #22,D0
00001BC6  4EB8 12C2               1733              JSR     UTLPRINT
00001BCA                          1734              
00001BCA  41F9 00001CBB           1735              LEA     .TXT10,A0
00001BD0  103C 0019               1736              MOVE.B  #25,D0
00001BD4  4EB8 12C2               1737              JSR     UTLPRINT
00001BD8                          1738              
00001BD8  4CDF 0103               1739  .DONE       MOVEM.L (A7)+,D0-D1/A0
00001BDC  4E75                    1740              RTS
00001BDE                          1741              
00001BDE= 53 50 41 43 45 20 ...   1742  .TXT1       DC.B    'SPACE INVADERS',0
00001BED= 49 4E 53 54 52 55 ...   1743  .TXT2       DC.B    'INSTRUCTIONS:',0
00001BFB= 50 52 45 53 53 20 ...   1744  .TXT3       DC.B    'PRESS -> TO MOVE TO THE RIGHT',0
00001C19= 50 52 45 53 53 20 ...   1745  .TXT4       DC.B    'PRESS <- TO MOVE TO THE LEFT',0
00001C36= 50 52 45 53 53 20 ...   1746  .TXT5       DC.B    'PRESS KEY UP TO SHOOT',0
00001C4C= 47 4F 41 4C 3A 00       1747  .TXT6       DC.B    'GOAL:',0
00001C52= 4B 49 4C 4C 20 41 ...   1748  .TXT7       DC.B    'KILL ALL THE ALIENS BEFORE THEY REACH THE TANK',0
00001C81= 57 49 54 48 20 41 ...   1749  .TXT8       DC.B    'WITH AS FEW SHOTS AS POSSIBLE',0 
00001C9F= 50 52 45 53 53 20 ...   1750  .TXT9       DC.B    'PRESS SPACE TO SEE THE DEMO',0
00001CBB= 50 52 45 53 53 20 ...   1751  .TXT10      DC.B    'PRESS KEY DOWN TO START THE GAME',0
00001CDC                          1752              DS.W    0
00001CDC                          1753  
00001CDC                          1754  
00001CDC                          1755  
00001CDC                          1756  
00001CDC                          1757  
00001CDC                          1758  
00001CDC                          1759  
00001CDC                          1760  
00001CDC                          1761  
00001CDC                          1762  
00001CDC                          1763  
00001CDC                          1764  
00001CDC                          1765  
00001CDC                          1766  
00001CDC                          1767  
00001CDC                          1768  
00001CDC                          1769  -------------------- end include --------------------
00001CDC                          1770              INCLUDE "DEMO.X68"  
00001CDC                          1771  ; ==============================================================================
00001CDC                          1772  ; GESTIÓN DE LA DEMO
00001CDC                          1773  ; ==============================================================================
00001CDC                          1774  
00001CDC                          1775  ; ------------------------------------------------------------------------------
00001CDC                          1776  DEMINIT
00001CDC                          1777  ; INICIALIZA LA DEMO
00001CDC                          1778  ; ------------------------------------------------------------------------------
00001CDC  4EB8 1000               1779              JSR     DMMINIT
00001CE0  4EB8 1966               1780              JSR     FILINIT
00001CE4  4EB8 1412               1781              JSR     TNKINIT
00001CE8  4EB8 151A               1782              JSR     ALNINIT  
00001CEC  6000 FBB0               1783              BRA     SCOINIT
00001CF0                          1784  
00001CF0                          1785  ; ------------------------------------------------------------------------------
00001CF0                          1786  DEMUPD
00001CF0                          1787  ; ACTUALIZA LA DEMO. PERMITE PASAR A OTRO ESTADO.
00001CF0                          1788  ; ------------------------------------------------------------------------------
00001CF0  4EB8 198C               1789              JSR     FILUPD
00001CF4  4EB8 1262               1790              JSR     AGLUPD
00001CF8  4EB8 154A               1791              JSR     ALNUPD
00001CFC                          1792              
00001CFC                          1793              ;EN CUALQUIER MOMENTO SE PUEDE PASAR AL SIGUIENTE ESTADO
00001CFC  0839 0000 00001F9B      1794              BTST.B  #0,(KBDEDGE)        ;SI PULSA KEY DOWN
00001D04  6700 000E               1795              BEQ     .CONT
00001D08  33FC 0002 00001F96      1796              MOVE.W  #2,(STANEXT)        ;PASA AL JUEGO
00001D10  6000 0014               1797              BRA     .DONE
00001D14  0839 0004 00001F9B      1798  .CONT       BTST.B  #4,(KBDEDGE)        ;SI PULSA EL ESPACIO
00001D1C  6700 0008               1799              BEQ     .DONE
00001D20  4279 00001F96           1800              CLR.W   (STANEXT)           ;PASA A LA INTRO
00001D26  4E75                    1801  .DONE       RTS
00001D28                          1802  
00001D28                          1803  ; ------------------------------------------------------------------------------
00001D28                          1804  DEMPLOT
00001D28                          1805  ; MUESTRA LA DEMO. MUESTRA TEXTO PARA PASAR A SIGUIENTE ESTADO.
00001D28                          1806  ; ------------------------------------------------------------------------------
00001D28  48E7 C080               1807              MOVEM.L D0-D1/A0,-(A7)
00001D2C                          1808              
00001D2C  4EB8 1286               1809              JSR     AGLPLOT
00001D30  4EB8 1476               1810              JSR     TNKPLOT
00001D34  4EB8 15FC               1811              JSR     ALNPLOT
00001D38  4EB8 18B2               1812              JSR     SCOPLOT
00001D3C                          1813  
00001D3C                          1814              ;ESTABLECE COLOR RELLENO
00001D3C                          1815m             SET_FILL_COLOR  #STAFLCLR
00001D3C                          1816m ; ACTIVA EL COLOR DE RELLENO PARA DIBUJADO.
00001D3C                          1817m ; INPUT    : #STAFLCLR COLOR EN FORMATO $00BBGGRR
00001D3C                          1818m ; MODIFICA : D0,D1
00001D3C                          1819m ;------------------------------------------------------------------------------
00001D4C                          1820              
00001D4C                          1821              ;IMPRIME LINEAS DE TEXTO PARA PASAR A SIGUIENTE ESTADO
00001D4C  41F9 00001D6A           1822              LEA     .TXT1,A0
00001D52  103C 0001               1823              MOVE.B  #1,D0
00001D56  4EB8 12C2               1824              JSR     UTLPRINT
00001D5A                          1825              
00001D5A  41F9 00001D8D           1826              LEA     .TXT2,A0
00001D60  4EB8 12C2               1827              JSR     UTLPRINT           
00001D64                          1828              
00001D64  4CDF 0103               1829  .DONE       MOVEM.L (A7)+,D0-D1/A0
00001D68  4E75                    1830              RTS
00001D6A                          1831              
00001D6A= 50 52 45 53 53 20 ...   1832  .TXT1       DC.B    'PRESS SPACE TO RETURN TO THE INTRO',0
00001D8D= 50 52 45 53 53 20 ...   1833  .TXT2       DC.B    'PRESS KEY DOWN TO START THE GAME',0
00001DAE                          1834              DS.W    0
00001DAE                          1835  
00001DAE                          1836  
00001DAE                          1837  
00001DAE                          1838  
00001DAE                          1839  
00001DAE                          1840  
00001DAE                          1841  
00001DAE                          1842              
00001DAE                          1843  
00001DAE                          1844  
00001DAE                          1845              
00001DAE                          1846  
00001DAE                          1847  
00001DAE                          1848  
00001DAE                          1849  
00001DAE                          1850  
00001DAE                          1851  
00001DAE                          1852  -------------------- end include --------------------
00001DAE                          1853              INCLUDE "GAME.X68"
00001DAE                          1854  ; ==============================================================================
00001DAE                          1855  ; GESTIÓN DEL JUEGO
00001DAE                          1856  ; ==============================================================================
00001DAE                          1857  
00001DAE                          1858  ; ------------------------------------------------------------------------------
00001DAE                          1859  GAMINIT
00001DAE                          1860  ; INICIALIZA JUEGO
00001DAE                          1861  ; ------------------------------------------------------------------------------
00001DAE  4EB8 1000               1862              JSR     DMMINIT
00001DB2  4EB8 1412               1863              JSR     TNKINIT
00001DB6  4EB8 151A               1864              JSR     ALNINIT 
00001DBA  6000 FAE2               1865              BRA     SCOINIT
00001DBE                          1866  
00001DBE                          1867  ; ------------------------------------------------------------------------------
00001DBE                          1868  GAMUPD
00001DBE                          1869  ; ACTUALIZA EL JUEGO. COMPRUEBA EL TECLADO. COMPRUEBA VICTORIA/DERROTA Y PASA 
00001DBE                          1870  ; AL SIGUIENTE ESTADO
00001DBE                          1871  ; ------------------------------------------------------------------------------
00001DBE  48E7 C070               1872              MOVEM.L D0-D1/A1-A3,-(A7)
00001DC2                          1873  
00001DC2                          1874              ;AÑADIR DISPARO SI TECLADO = "UP" 
00001DC2  0839 0002 00001F9B      1875              BTST.B  #2,(KBDEDGE)
00001DCA  6700 001C               1876              BEQ     .GOUPD
00001DCE  43F8 174E               1877              LEA     SHTINIT,A1
00001DD2  45F8 1766               1878              LEA     SHTUPD,A2
00001DD6  47F8 1852               1879              LEA     SHTPLOT,A3
00001DDA  303C 0001               1880              MOVE.W  #1,D0
00001DDE  4EB8 1248               1881              JSR     AGLADD
00001DE2  5279 00001F90           1882              ADDQ.W  #1,(SCOSHOOT)
00001DE8                          1883  
00001DE8                          1884  .GOUPD      ;UPDATES
00001DE8  4EB8 1262               1885              JSR     AGLUPD 
00001DEC  4EB8 142E               1886              JSR     TNKUPD
00001DF0  4EB8 154A               1887              JSR     ALNUPD
00001DF4                          1888              
00001DF4                          1889              ;COMPROBAR SI HA GANADO
00001DF4  0C79 001E 00001F8E      1890              CMP.W   #SCOWIN,(SCOPOINT)
00001DFC  6D00 000E               1891              BLT     .NEXT
00001E00  33FC 0003 00001F96      1892              MOVE.W  #3,(STANEXT)                ;PASAR A ESTADO VICTORIA
00001E08  6000 001C               1893              BRA     .DONE
00001E0C                          1894              
00001E0C                          1895              ;COMPROBAR SI HA PERDIDO
00001E0C  3239 00001F82           1896  .NEXT       MOVE.W  (ALNPOSY),D1
00001E12  0641 0078               1897              ADD.W   #ALNDIM*ALNMPROW,D1         ;D1 = ALNPOSY+ALNDIM*ALNMPROW
00001E16  B27C 01A0               1898              CMP.W   #TNKPOSY,D1                 ;COMPARAR CON POS(Y) TANQUE
00001E1A  6D00 000A               1899              BLT     .DONE
00001E1E  33FC 0004 00001F96      1900              MOVE.W  #4,(STANEXT)                ;PASAR A ESTADO DERROTA
00001E26                          1901  
00001E26  4CDF 0E03               1902  .DONE       MOVEM.L (A7)+,D0-D1/A1-A3    
00001E2A  4E75                    1903              RTS  
00001E2C                          1904  
00001E2C                          1905  ; ------------------------------------------------------------------------------
00001E2C                          1906  GAMPLOT
00001E2C                          1907  ; MUESTRA EL JUEGO EN PANTALLA
00001E2C                          1908  ; ------------------------------------------------------------------------------
00001E2C  4EB8 1286               1909              JSR     AGLPLOT
00001E30  4EB8 1476               1910              JSR     TNKPLOT
00001E34  4EB8 15FC               1911              JSR     ALNPLOT
00001E38  6000 FA78               1912              BRA     SCOPLOT
00001E3C                          1913  
00001E3C                          1914  
00001E3C                          1915  
00001E3C                          1916  
00001E3C                          1917  
00001E3C                          1918  
00001E3C                          1919  
00001E3C                          1920  
00001E3C                          1921  
00001E3C                          1922  
00001E3C                          1923  
00001E3C                          1924  -------------------- end include --------------------
00001E3C                          1925              INCLUDE "WIN.X68"
00001E3C                          1926  ; ==============================================================================
00001E3C                          1927  ; PANTALLA DE VICTORIA
00001E3C                          1928  ; ==============================================================================
00001E3C                          1929  
00001E3C                          1930  ; ------------------------------------------------------------------------------
00001E3C                          1931  WININIT
00001E3C                          1932  ; INICIALIZA PANTALLA DE VICTORIA. REPRODUCE SONIDO DE VICTORIA.
00001E3C                          1933  ; ------------------------------------------------------------------------------      
00001E3C  48E7 E000               1934              MOVEM.L D0-D2,-(A7)
00001E40                          1935              
00001E40                          1936              ;QUITA SONIDO ANTERIOR
00001E40  103C 004C               1937              MOVE.B  #76,D0
00001E44  1207                    1938              MOVE.B  D7,D1 
00001E46  7402                    1939              MOVE.L  #2,D2
00001E48  4E4F                    1940              TRAP    #15         
00001E4A                          1941  
00001E4A                          1942              ;REPRODUCE SONIDO DE VICTORIA
00001E4A  1E3C 0002               1943              MOVE.B  #SNDWIN,D7
00001E4E  4E42                    1944              TRAP    #SNDPLTN
00001E50                          1945              
00001E50  4CDF 0007               1946              MOVEM.L (A7)+,D0-D2
00001E54  4E75                    1947              RTS
00001E56                          1948  ; ------------------------------------------------------------------------------
00001E56                          1949  WINUPD
00001E56                          1950  ; ACTUALIZA PANTALLA DE VICTORIA. PASA SIGUIENTE ESTADO CON TECLA HACIA ABAJO.
00001E56                          1951  ; ------------------------------------------------------------------------------
00001E56  0839 0000 00001F9B      1952              BTST.B  #0,(KBDEDGE)
00001E5E  6700 0008               1953              BEQ     .CONT
00001E62  4279 00001F96           1954              CLR.W   (STANEXT)
00001E68  4E75                    1955  .CONT       RTS
00001E6A                          1956  
00001E6A                          1957  ; ------------------------------------------------------------------------------
00001E6A                          1958  WINPLOT
00001E6A                          1959  ; MUESTRA PANTALLA DE VICTORIA CON TEXTO.
00001E6A                          1960  ; ------------------------------------------------------------------------------
00001E6A  48E7 C080               1961              MOVEM.L D0-D1/A0,-(A7)
00001E6E                          1962              
00001E6E                          1963              ;ESTABLECE COLOR RELLENO
00001E6E                          1964m             SET_FILL_COLOR  #STAFLCLR
00001E6E                          1965m ; ACTIVA EL COLOR DE RELLENO PARA DIBUJADO.
00001E6E                          1966m ; INPUT    : #STAFLCLR COLOR EN FORMATO $00BBGGRR
00001E6E                          1967m ; MODIFICA : D0,D1
00001E6E                          1968m ;------------------------------------------------------------------------------
00001E7E                          1969              
00001E7E                          1970              ;IMPRIME LÍNEAS DE TEXTO
00001E7E  41F9 00001EA0           1971              LEA     .TXT1,A0
00001E84  103C 000A               1972              MOVE.B  #10,D0
00001E88  4EB8 12C2               1973              JSR     UTLPRINT
00001E8C                          1974              
00001E8C  41F9 00001EA9           1975              LEA     .TXT2,A0
00001E92  103C 0019               1976              MOVE.B  #25,D0
00001E96  4EB8 12C2               1977              JSR     UTLPRINT    
00001E9A                          1978              
00001E9A  4CDF 0103               1979  .DONE       MOVEM.L (A7)+,D0-D1/A0
00001E9E  4E75                    1980              RTS
00001EA0                          1981              
00001EA0= 59 4F 55 20 57 4F ...   1982  .TXT1       DC.B    'YOU WON!',0
00001EA9= 50 52 45 53 53 20 ...   1983  .TXT2       DC.B    'PRESS KEY DOWN TO CONTINUE',0
00001EC4                          1984              DS.W    0
00001EC4                          1985  
00001EC4                          1986  
00001EC4                          1987  
00001EC4                          1988  
00001EC4                          1989  
00001EC4                          1990  
00001EC4                          1991  
00001EC4                          1992  
00001EC4                          1993  
00001EC4                          1994  
00001EC4                          1995  
00001EC4                          1996  
00001EC4                          1997  
00001EC4                          1998  
00001EC4                          1999  -------------------- end include --------------------
00001EC4                          2000              INCLUDE "GOVER.X68"            
00001EC4                          2001  ; ==============================================================================
00001EC4                          2002  ; PANTALLA DE DERROTA
00001EC4                          2003  ; ============================================================================== 
00001EC4                          2004  
00001EC4                          2005  ; ------------------------------------------------------------------------------
00001EC4                          2006  GOVINIT
00001EC4                          2007  ; INICIALIZA PANTALLA DE DERROTA. REPRODUCE SONIDO DE DERROTA.
00001EC4                          2008  ; ------------------------------------------------------------------------------
00001EC4  48E7 E000               2009              MOVEM.L D0-D2,-(A7)
00001EC8                          2010              
00001EC8                          2011              ;QUITA SONIDO ANTERIOR
00001EC8  103C 004C               2012              MOVE.B  #76,D0
00001ECC  1207                    2013              MOVE.B  D7,D1 
00001ECE  7402                    2014              MOVE.L  #2,D2
00001ED0  4E4F                    2015              TRAP    #15
00001ED2                          2016              
00001ED2                          2017              ;REPRODUCE SONIDO DE DERROTA
00001ED2  1E3C 0003               2018              MOVE.B  #SNDGOV,D7
00001ED6  4E42                    2019              TRAP    #SNDPLTN
00001ED8                          2020              
00001ED8  4CDF 0007               2021              MOVEM.L (A7)+,D0-D2
00001EDC  4E75                    2022              RTS
00001EDE                          2023              
00001EDE                          2024  ; ------------------------------------------------------------------------------
00001EDE                          2025  GOVUPD
00001EDE                          2026  ; ACTUALIZA PANTALLA DE DERROTA. PASA SIGUIENTE ESTADO CON TECLA HACIA ABAJO.
00001EDE                          2027  ; ------------------------------------------------------------------------------
00001EDE  0839 0000 00001F9B      2028              BTST.B  #0,(KBDEDGE)
00001EE6  6700 0008               2029              BEQ     .CONT
00001EEA  4279 00001F96           2030              CLR.W   (STANEXT)
00001EF0  4E75                    2031  .CONT       RTS
00001EF2                          2032  
00001EF2                          2033  ; ------------------------------------------------------------------------------
00001EF2                          2034  GOVPLOT
00001EF2                          2035  ; MUESTRA PANTALLA DE DERROTA CON LÍNEAS DE TEXTO
00001EF2                          2036  ; ------------------------------------------------------------------------------
00001EF2  48E7 C080               2037              MOVEM.L D0-D1/A0,-(A7)
00001EF6                          2038              
00001EF6                          2039              ;ESTABLECE COLOR RELLENO
00001EF6                          2040m             SET_FILL_COLOR  #STAFLCLR
00001EF6                          2041m ; ACTIVA EL COLOR DE RELLENO PARA DIBUJADO.
00001EF6                          2042m ; INPUT    : #STAFLCLR COLOR EN FORMATO $00BBGGRR
00001EF6                          2043m ; MODIFICA : D0,D1
00001EF6                          2044m ;------------------------------------------------------------------------------
00001F06                          2045              
00001F06                          2046              ;LÍNEAS DE TEXTO
00001F06  41F9 00001F28           2047              LEA     .TXT1,A0
00001F0C  103C 000A               2048              MOVE.B  #10,D0
00001F10  4EB8 12C2               2049              JSR     UTLPRINT   
00001F14                          2050              
00001F14  41F9 00001F32           2051              LEA     .TXT2,A0
00001F1A  103C 0019               2052              MOVE.B  #25,D0
00001F1E  4EB8 12C2               2053              JSR     UTLPRINT
00001F22                          2054                
00001F22  4CDF 0103               2055  .DONE       MOVEM.L (A7)+,D0-D1/A0
00001F26  4E75                    2056              RTS
00001F28                          2057              
00001F28= 47 41 4D 45 20 4F ...   2058  .TXT1       DC.B    'GAME OVER',0
00001F32= 50 52 45 53 53 20 ...   2059  .TXT2       DC.B    'PRESS KEY DOWN TO CONTINUE',0
00001F4E                          2060              DS.W    0
00001F4E                          2061  
00001F4E                          2062  
00001F4E                          2063  
00001F4E                          2064  
00001F4E                          2065  
00001F4E                          2066  
00001F4E                          2067  
00001F4E                          2068  
00001F4E                          2069  
00001F4E                          2070  
00001F4E                          2071  
00001F4E                          2072  -------------------- end include --------------------
00001F4E                          2073              
00001F4E                          2074  START
00001F4E  007C 0700               2075              ORI.W   #$0700,SR
00001F52                          2076              
00001F52                          2077              ;INICIALIZACIONES
00001F52  4EB8 10C2               2078              JSR     SYSINIT
00001F56  4EB8 12AC               2079              JSR     UTLINIT
00001F5A  4EB8 1A50               2080              JSR     STAINIT
00001F5E                          2081                
00001F5E                          2082  .LOOP
00001F5E  4E41                    2083              TRAP    #1
00001F60                          2084              
00001F60                          2085              ;ACTUALIZA ESTADO ACTUAL         
00001F60  4EB8 1A60               2086              JSR     STAUPD
00001F64                          2087              
00001F64                          2088              ;SINCRONIZA
00001F64  4A39 00001F9C           2089  .WINT       TST.B   (SCRINTCT)
00001F6A  67F8                    2090              BEQ     .WINT
00001F6C  4239 00001F9C           2091              CLR.B   (SCRINTCT)
00001F72                          2092              
00001F72                          2093              ;DIBUJA ESTADO ACTUAL
00001F72  4EB8 1AC6               2094              JSR     STAPLOT
00001F76                          2095               
00001F76                          2096              ;ACTUALIZA DOUBLE BUFFER
00001F76  4E40                    2097              TRAP    #0  
00001F78                          2098              
00001F78  60E4                    2099              BRA     .LOOP
00001F7A                          2100  .DONE    
00001F7A  FFFF FFFF               2101              SIMHALT
00001F7E                          2102        
00001F7E                          2103              INCLUDE "VARS.X68"
00001F7E                          2104  ; ==============================================================================
00001F7E                          2105  ; VARIABLES DE JUEGO
00001F7E                          2106  ; ==============================================================================
00001F7E                          2107  
00001F7E                          2108      ;VARIABLES TANQUE
00001F7E                          2109  TNKPOSX     DS.W    1   ;POSICIÓN X TANQUE
00001F80                          2110  
00001F80                          2111      ;VARIABLES ALIEN
00001F80                          2112  ALNPOSX     DS.W    1   ;POSICIÓN X ALIEN
00001F82                          2113  ALNPOSY     DS.W    1   ;POSICIÓN Y ALIEN
00001F84                          2114  ALNVELX     DS.W    1   ;VELOCIDAD ALIENS X (FUNCIONA PARA NIVEL 1 y 3)
00001F86                          2115  ALNVELX2    DS.W    1   ;VELOCIDAD ALIENS X (FUNCIONA PARA NIVEL 2)
00001F88                          2116  ALNVELY     DS.W    1   ;VELOCIDAD ALIENS Y
00001F8A                          2117  
00001F8A                          2118      ;VARIABLES DISPARO
00001F8A                          2119  SHTPOSX     DS.W    1   ;POSICIÓN X DISPARO
00001F8C                          2120  SHTPOSY     DS.W    1   ;POSICIÓN Y DISPARO
00001F8E                          2121  
00001F8E                          2122      ;VARIABLES MARCADOR
00001F8E                          2123  SCOPOINT    DS.W    1   ;PUNTUACIÓN JUGADOR
00001F90                          2124  SCOSHOOT    DS.W    1   ;NUMERO DE DISPAROS JUGADOR  
00001F92                          2125  SCOLEVEL    DS.W    1   ;NIVEL DE DIFICULTAD
00001F94                          2126  
00001F94                          2127      ;VARIABLES ESTADO
00001F94                          2128  STACUR      DS.W    1   ;ESTADO ACTUAL
00001F96                          2129  STANEXT     DS.W    1   ;SIGUIENTE ESTADO
00001F98                          2130  
00001F98                          2131  
00001F98                          2132  
00001F98                          2133  
00001F98                          2134  
00001F98                          2135  
00001F98                          2136  
00001F98                          2137  
00001F98                          2138  
00001F98                          2139  
00001F98                          2140  
00001F98                          2141  
00001F98                          2142  
00001F98                          2143  
00001F98                          2144  
00001F98                          2145  
00001F98                          2146  
00001F98                          2147  
00001F98                          2148  
00001F98                          2149  
00001F98                          2150  -------------------- end include --------------------
00001F98                          2151              INCLUDE "LIB/UTLVARS.X68"
00001F98                          2152  ; =============================================================================
00001F98                          2153  ; UTILITY VARIABLES
00001F98                          2154  ; =============================================================================
00001F98                          2155  
00001F98                          2156  UTLRNDIX    DS.B    1                       ; NEXT INDEX TO RANDOM NUMBER
00001F9A                          2157              DS.W    0
00001F9A                          2158  -------------------- end include --------------------
00001F9A                          2159              INCLUDE "SYSVARS.X68"
00001F9A                          2160  ; ==============================================================================
00001F9A                          2161  ; VARIABLES DE SISTEMA
00001F9A                          2162  ; ==============================================================================
00001F9A                          2163      
00001F9A                          2164      ;VARIABLES TECLADO    
00001F9A                          2165  KBDVAL      DS.B    1
00001F9B                          2166  KBDEDGE     DS.B    1
00001F9C                          2167  
00001F9C                          2168      ;VARIABLES CONTADORES
00001F9C                          2169  SCRINTCT    DS.B    1       ;CONTADOR DE INTERRUPCIONES
00001F9D                          2170  SCRCYCCT    DS.B    1       ;CONTADOR DE CICLOS
00001F9E                          2171              
00001F9E                          2172           
00001F9E                          2173  
00001F9E                          2174  
00001F9E                          2175  
00001F9E                          2176  
00001F9E                          2177  
00001F9E                          2178  
00001F9E                          2179  
00001F9E                          2180  
00001F9E                          2181  
00001F9E                          2182  
00001F9E                          2183  
00001F9E                          2184  -------------------- end include --------------------
00001F9E                          2185              INCLUDE "LIB/DMMVARS.X68"
00001F9E                          2186  ; =============================================================================
00001F9E                          2187  ; DYNAMIC MEMORY MANAGEMENT VARIABLES (SYSTEM VARIABLES)
00001F9E                          2188  ; =============================================================================
00001F9E                          2189  
00001FC0                          2190              ORG     (*+DMMBSIZE-1)&-DMMBSIZE ; ALIGN TO DMMBSIZE
00001FC0                          2191  DMMDATA     DS.B    DMMBSIZE*DMMBNUM        ; DYNAMIC MEMORY ALLOCATION SPACE
00002C40                          2192              DS.W    0                       ; JUST IN CASE (SIZE IS POW OF TWO)
00002C40                          2193  -------------------- end include --------------------
00002C40                          2194   
00002C40                          2195              END    START      

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
AGLADD              1248
AGLADD:END          125E
AGLKILL             10AC
AGLPLOT             1286
AGLPLOT:END         12A6
AGLPLOT:LOOP        128E
AGLUPD              1262
AGLUPD:END          1280
AGLUPD:LOOP         126A
ALNCOL              A
ALNDATA             16D2
ALNDIM              28
ALNFLCLR            FF00
ALNINIT             151A
ALNIPOSX            78
ALNIPOSY            50
ALNMPCOL            A
ALNMPLOT            1692
ALNMPLOT:CLOOP1     16AA
ALNMPLOT:NEXT1      16BC
ALNMPLOT:RLOOP1     16B4
ALNMPROW            3
ALNPIXEL            B
ALNPLOT             15FC
ALNPLOT:CLOOP       163E
ALNPLOT:NEXT        165A
ALNPLOT:RLOOP       164E
ALNPNCLR            AA00
ALNPOSX             1F80
ALNPOSY             1F82
ALNROW              A
ALNSPD1             8
ALNSPD2             C
ALNUPD              154A
ALNUPD:CHKCOL       15A6
ALNUPD:COLLFT       15D4
ALNUPD:COLRGT       15BA
ALNUPD:DONE         15EA
ALNUPD:LVL1         156E
ALNUPD:LVL2         1580
ALNUPD:LVL3         1592
ALNVELX             1F84
ALNVELX2            1F86
ALNVELY             1F88
DEMINIT             1CDC
DEMPLOT             1D28
DEMPLOT:DONE        1D64
DEMPLOT:TXT1        1D6A
DEMPLOT:TXT2        1D8D
DEMUPD              1CF0
DEMUPD:CONT         1D14
DEMUPD:DONE         1D26
DISPCLR             FF66
DMMALLOC            1092
DMMALLOC:END        10AA
DMMBNUM             32
DMMBSIZE            40
DMMDATA             1FC0
DMMFCOM             106C
DMMFFND             107A
DMMFIRST            1022
DMMFLOOP            1060
DMMFRCOM            1034
DMMFREE             10AC
DMMFRFND            1042
DMMFRLOP            1028
DMMFRSTO            105A
DMMINIT             1000
DMMINIT:LOOP        100E
DMMNEXT             1044
DMMNEXTO            107C
DMMSYSID            0
FILINIT             1966
FILINIT:DONE        1976
FILINIT:FILE        197C
FILUPD              198C
FILUPD:BUFFER       19EC
FILUPD:DONE         19E6
FILUPD:NEXT1        19C6
FILUPD:NEXT2        19D8
GAMINIT             1DAE
GAMPLOT             1E2C
GAMUPD              1DBE
GAMUPD:DONE         1E26
GAMUPD:GOUPD        1DE8
GAMUPD:NEXT         1E0C
GOVINIT             1EC4
GOVPLOT             1EF2
GOVPLOT:DONE        1F22
GOVPLOT:TXT1        1F28
GOVPLOT:TXT2        1F32
GOVUPD              1EDE
GOVUPD:CONT         1EF0
INTINIT             1AF8
INTPLOT             1B40
INTPLOT:DONE        1BD8
INTPLOT:TXT1        1BDE
INTPLOT:TXT10       1CBB
INTPLOT:TXT2        1BED
INTPLOT:TXT3        1BFB
INTPLOT:TXT4        1C19
INTPLOT:TXT5        1C36
INTPLOT:TXT6        1C4C
INTPLOT:TXT7        1C52
INTPLOT:TXT8        1C81
INTPLOT:TXT9        1C9F
INTUPD              1B12
INTUPD:CONT         1B2A
INTUPD:DONE         1B3E
KBDDOWN             28
KBDEDGE             1F9B
KBDFIRE1            41
KBDFIRE2            53
KBDFIRE3            44
KBDINIT             11EC
KBDLEFT             25
KBDPAUSE            20
KBDRIGHT            27
KBDUP               26
KBDUPD              11FA
KBDUPD:LOOP         123E
KBDUPD:PACK         123A
KBDUPTN             1
KBDVAL              1F9A
LIMIT               0
MAPDATA             1674
MAPPLOT             1736
NIVEL1              1
NIVEL2              2
NIVEL3              3
NIVELCR             FFA500
RESET_LOOP          1742
SCOFLCLR            0
SCOINIT             189E
SCOLEVEL            1F92
SCOLINE             101
SCOLINE1            4101
SCOLINE2            4102
SCOPLOT             18B2
SCOPLOT:TXT         1948
SCOPLOT:TXT1        1954
SCOPLOT:TXT2        195E
SCOPOINT            1F8E
SCOSHOOT            1F90
SCOWIN              1E
SCRCYCCT            1F9D
SCRFPS              32
SCRHEIGH            1E0
SCRINIT             1180
SCRINTCT            1F9C
SCRPLOT             11C4
SCRTIM              11DE
SCRUPTN             0
SCRWIDTH            280
SET_FILL_COLOR      147
SET_PEN_COLOR       0
SHTADD              19EE
SHTFLCLR            FF
SHTGAP              A
SHTHEIGH            10
SHTINIT             174E
SHTPLOT             1852
SHTPNCLR            AA
SHTPOSX             1F8A
SHTPOSY             1F8C
SHTSPEED            A
SHTUPD              1766
SHTUPD:DONE         1848
SHTUPD:NEXT         178E
SHTWIDTH            4
SNDDEM              1
SNDGOV              3
SNDINIT             10FC
SNDINIT:DONE        111A
SNDINIT:LOOP        1108
SNDINIT:SNDCOL      1120
SNDINIT:SNDGOV      114C
SNDINIT:SNDINT      1132
SNDINIT:SNDLIST     115A
SNDINIT:SNDWIN      1140
SNDPLAY             116E
SNDPLTN             2
SNDSHT              0
SNDWIN              2
STACUR              1F94
STAEMPTY            1AF6
STAFLCLR            0
STAINIT             1A50
STANEXT             1F96
STANONE             FFFFFFFF
STAPLOT             1AC6
STAPLOT:PLTTBL      1AE2
START               1F4E
START:DONE          1F7A
START:LOOP          1F5E
START:WINT          1F64
STAUPD              1A60
STAUPD:DOUPD        1A86
STAUPD:INITBL       1A9E
STAUPD:UPDTBL       1AB2
SYSINIT             10C2
TNKCOL              9
TNKFLCLR            FF0000
TNKINIT             1412
TNKLEFT             1A32
TNKLEFT:DONE        1A46
TNKMAP              14E4
TNKPLOT             1476
TNKPLOT:CLOOP       14B8
TNKPLOT:NEXT        14CE
TNKPLOT:RLOOP       14C6
TNKPNCLR            AA0000
TNKPOSX             1F7E
TNKPOSY             1A0
TNKRIGHT            1A12
TNKRIGHT:DONE       1A28
TNKROW              6
TNKSPEED            8
TNKSQUWI            8
TNKUPD              142E
TNKUPD:CHKLEFT      1452
TNKUPD:CHKRIGHT     1460
TNKUPD:DONE         146C
TNKUPD:LEFT         1444
TNKWIDHA            24
TNKWIDTH            48
UTLCHRWD            8
UTLINIT             12AC
UTLPRINT            12C2
UTLPRINT:ENDLOOP    12D4
UTLPRINT:LOOP       12CA
UTLRAND             12F4
UTLRAND:RANDVEC     1312
UTLRNDIX            1F98
WININIT             1E3C
WINPLOT             1E6A
WINPLOT:DONE        1E9A
WINPLOT:TXT1        1EA0
WINPLOT:TXT2        1EA9
WINUPD              1E56
WINUPD:CONT         1E68
